
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#FFB800">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CalPro">
  <meta name="mobile-web-app-capable" content="yes">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>CalPro - Calibration Management System</title>
  <!-- Critical CSS First -->
  <link rel="stylesheet" href="styles.css?v=20251017">
  <link rel="stylesheet" href="css/mobile-advanced.css?v=20251017">
  <link rel="stylesheet" href="css/mobile-responsive-fixes.css?v=20251017">
  <link rel="manifest" href="manifest.json">
  
  <!-- Advanced Mobile Enhancement - Load Early -->
  <script src="js/mobile-enhancer-advanced.js?v=20251017" defer></script>
  
  <!-- Non-critical resources - Load Later -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" media="print" onload="this.media='all'">
  
  <!-- Heavy Libraries - Load on Demand -->
  <script>
    window.loadJsPDF = function() {
      if (!window.jsPDFLoading && !window.jsPDF) {
        window.jsPDFLoading = true;
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = () => window.jsPDFLoading = false;
        document.head.appendChild(script);
      }
    };
    
    window.loadChartJS = function() {
      if (!window.chartJSLoading && !window.Chart) {
        window.chartJSLoading = true;
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js';
        script.onload = () => window.chartJSLoading = false;
        document.head.appendChild(script);
      }
    };
  </script>
  
  <!-- Loading Screen Styles -->
  <style>
    #appLoadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #FFB800 0%, #FF8C00 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease-out;
    }
    #appLoadingScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    /* Mobile Loading Optimization */
    @media (max-width: 768px) {
      .loading-logo {
        width: 80px !important;
        height: 80px !important;
        margin-bottom: 20px !important;
      }
      .loading-text {
        font-size: 18px !important;
      }
      .loading-subtext {
        font-size: 14px !important;
      }
    }
    .loading-logo {
      width: 120px;
      height: 120px;
      margin-bottom: 30px;
      animation: pulse 2s ease-in-out infinite;
    }
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      margin-top: 20px;
      color: white;
      font-size: 18px;
      font-weight: 500;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
  </style>
</head>
<body>
  <!-- Modern Loading Screen with Progress -->
  <div id="appLoadingScreen">
    <div class="loading-logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="white">
        <circle cx="50" cy="50" r="40" stroke="white" stroke-width="3" fill="none"/>
        <path d="M50 20 L50 50 L70 50" stroke="white" stroke-width="3" fill="none"/>
      </svg>
    </div>
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading CalPro...</div>
  </div>

  <!-- Mobile Header (visible only on mobile) -->
  <header class="app-header mobile-only">
    <div class="header-logo">
      <i class="fas fa-balance-scale"></i>
      <span>CalPro</span>
    </div>
    <div class="header-actions">
      <button class="header-icon-btn" id="mobileSearchBtn" aria-label="Search">
        <i class="fas fa-search"></i>
      </button>
      <button class="header-icon-btn" id="mobileNotificationsBtn" aria-label="Notifications">
        <i class="fas fa-bell"></i>
        <span class="badge"></span>
      </button>
      <button class="header-icon-btn" id="mobileProfileBtn" aria-label="Profile">
        <i class="fas fa-user-circle"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Bottom Navigation (visible only on mobile) -->
  <nav class="mobile-bottom-nav mobile-only" role="navigation" aria-label="Mobile navigation">
    <a href="#dashboard" class="nav-tab active touch-feedback" data-page="dashboard">
      <i class="nav-tab-icon fas fa-home"></i>
      <span class="nav-tab-label">Home</span>
    </a>
    <a href="#worksheets" class="nav-tab touch-feedback" data-page="worksheets">
      <i class="nav-tab-icon fas fa-file-alt"></i>
      <span class="nav-tab-label">Worksheets</span>
      <span class="nav-badge">3</span>
    </a>
    <a href="#equipment" class="nav-tab touch-feedback" data-page="equipment">
      <i class="nav-tab-icon fas fa-tools"></i>
      <span class="nav-tab-label">Equipment</span>
    </a>
    <a href="#certificates" class="nav-tab touch-feedback" data-page="certificates">
      <i class="nav-tab-icon fas fa-certificate"></i>
      <span class="nav-tab-label">Certificates</span>
    </a>
    <a href="#more" class="nav-tab touch-feedback" data-page="more">
      <i class="nav-tab-icon fas fa-ellipsis-h"></i>
      <span class="nav-tab-label">More</span>
    </a>
  </nav>

  <!-- Floating Action Button (mobile) -->
  <button class="fab mobile-only" id="mobileFAB" aria-label="Quick action">
    <i class="fas fa-plus"></i>
  </button>
  
  <!-- Authentication Check Script -->
  <script>
    // Check authentication before loading the page
    (function() {
      const token = localStorage.getItem('auth_token');
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      
      // If no token or user, redirect to login
      if (!token || !user) {
        window.location.href = '/login.html';
        return;
      }
      
      // Store user info globally for use throughout the app
      window.currentUser = user;
      window.authToken = token;
      
      // Demo mode detection
      const isDemoMode = window.location.hostname.includes('netlify') || 
                         window.location.hostname.includes('github.io') ||
                         window.location.hostname !== 'localhost';
      
      // Set default headers for all fetch requests
      window.fetchWithAuth = function(url, options = {}) {
        // Demo mode - return mock responses
        if (isDemoMode) {
          return Promise.resolve({
            ok: true,
            status: 200,
            json: () => Promise.resolve(getMockApiResponse(url)),
            text: () => Promise.resolve('Mock response')
          });
        }

        options.headers = {
          ...options.headers,
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        };
        return fetch(url, options)
          .then(response => {
            // If unauthorized, redirect to login
            if (response.status === 401) {
              localStorage.removeItem('auth_token');
              localStorage.removeItem('user');
              window.location.href = '/login.html';
              throw new Error('Session expired');
            }
            return response;
          });
      };

      // Mock API responses for demo mode
      function getMockApiResponse(url) {
        if (url.includes('/api/user/profile')) {
          return {
            id: 1,
            email: user.email,
            name: user.name,
            role: user.role,
            department: user.department,
            profile_picture: null,
            last_login: new Date().toISOString()
          };
        }
        if (url.includes('/api/users')) {
          return {
            users: [
              { id: 1, name: 'Demo Admin', email: 'admin@demo.com', role: 'admin', status: 'active' },
              { id: 2, name: 'Demo User', email: 'user@demo.com', role: 'calibrator', status: 'active' }
            ],
            total: 2,
            page: 1,
            totalPages: 1
          };
        }
        // Default mock response
        return { message: 'Demo mode - mock response', success: true };
      }
    })();
  </script>
  <!-- Navigation Sidebar -->
  <nav class="sidebar" id="sidebar" aria-label="Main navigation">
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <div class="sidebar-logo-text">
          <i class="fas fa-balance-scale" style="font-size: 36px; color: #FFB800;"></i>
        </div>
        <div class="sidebar-title">
          <h3>CalPro</h3>
          <p>Calibration Management</p>
        </div>
      </div>
    </div>
    
    <div class="sidebar-menu" role="menu">
      <div class="menu-section">
        <h4>Main</h4>
        <a href="#dashboard" class="menu-item active" data-section="dashboard" aria-current="page">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#worksheets" class="menu-item" data-section="worksheets">
          <i class="fas fa-file-lines"></i>
          <span>Worksheets</span>
        </a>
        <a href="#certificates" class="menu-item" data-section="certificates">
          <i class="fas fa-certificate"></i>
          <span>Certificates</span>
          <span class="menu-notification-badge" id="certificateNotificationBadge" style="display: none;"></span>
        </a>
        <a href="equipment.html" class="menu-item">
          <i class="fas fa-tools"></i>
          <span>Equipment</span>
        </a>
      </div>
      
      <!-- Services section removed - autocomplete provides equipment suggestions in forms -->
      
      <div class="menu-section">
        <h4>Management</h4>
        <a href="clients.html" class="menu-item">
          <i class="fas fa-users"></i>
          <span>Clients</span>
        </a>
        <a href="integrations.html" class="menu-item">
          <i class="fas fa-plug"></i>
          <span>Integrations</span>
        </a>
        <a href="#reports" class="menu-item" data-section="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Reports</span>
        </a>
        <a href="#settings" class="menu-item" data-section="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
      </div>

      <div class="menu-section">
        <h4>Tools</h4>
        <a href="converter.html" class="menu-item">
          <i class="fas fa-calculator"></i>
          <span>Unit Converter</span>
        </a>
      </div>
    </div>
    
    <div class="sidebar-footer">
      <div class="sidebar-status">
        <div class="status-item" id="connectionStatus">
          <i class="fas fa-wifi" id="connectionIcon"></i>
          <span id="connectionText">Online</span>
        </div>
        <div class="version-info">v2.0.0</div>
      </div>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="main-content" id="mainContent">
    
    <!-- Demo Mode Banner -->
    <div id="demo-mode-banner" style="display: none; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); color: #856404; padding: 12px 20px; margin: 0; border-bottom: 1px solid #ffeeba; text-align: center; font-weight: 500;">
      <i class="fas fa-flask"></i> <strong>Demo Mode Active:</strong> This is a testing environment with simulated data and functionality
    </div>
    
    <!-- Modern Top Header Bar -->
    <header class="top-header">
      <div class="header-left">
        <!-- Mobile Menu Toggle Button -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu" style="display: none;">
          <i class="fas fa-bars"></i>
        </button>
        
        <div class="company-brand">
          <div class="header-logo-icon" id="headerLogo" title="Toggle Sidebar" style="font-size: 32px; color: #FFB800; cursor: pointer; margin-right: 15px;">
            <i class="fas fa-balance-scale"></i>
          </div>
          <div class="brand-info">
            <h1 class="company-name">CalPro</h1>
            <span class="company-tagline">Professional Calibration Management System</span>
          </div>
        </div>
      </div>

      <div class="header-center">
        <div class="global-search">
          <i class="fas fa-search search-icon"></i>
          <input type="text" 
                 class="search-input" 
                 id="globalSearch" 
                 placeholder="Search certificates, worksheets, customers...">
        </div>
      </div>
      
      <div class="header-right">
        <!-- Live Clock -->
        <div class="time-widget">
          <i class="fas fa-clock"></i>
          <div class="time-info">
            <span class="time-display" id="currentTime">00:00:00</span>
            <span class="date-display" id="currentDate">Mon, Oct 14</span>
          </div>
        </div>
        
        <!-- Notifications -->
        <div class="notification-container">
          <button class="header-icon-btn" id="notificationBtn" title="Notifications">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount">0</span>
          </button>
          
          <div class="notification-dropdown" id="notificationDropdown">
            <div class="dropdown-header">
              <h4>Notifications</h4>
              <button class="mark-read-btn" onclick="clearAllNotifications()">Clear all</button>
            </div>
            <div class="dropdown-content" id="notificationList">
              <div class="empty-notifications">
                <i class="fas fa-bell-slash"></i>
                <p>No new notifications</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- User Profile -->
        <div class="user-profile-widget">
          <button class="user-profile-btn" id="userProfileBtn">
            <div class="user-avatar">
              <img src="https://ui-avatars.com/api/?name=E+Mensah&background=FFB800&color=333&bold=true" alt="User Avatar">
              <span class="user-status-dot online"></span>
            </div>
            <div class="user-details">
              <span class="user-name" id="headerUserName">John Doe</span>
              <span class="user-role">Lead Calibrator</span>
            </div>
            <i class="fas fa-chevron-down dropdown-icon"></i>
          </button>
          
          <div class="user-dropdown" id="userDropdown">
            <div class="user-dropdown-header">
              <div class="user-avatar-large">
                <img src="https://ui-avatars.com/api/?name=E+Mensah&background=FFB800&color=333&bold=true&size=64" alt="User Avatar">
              </div>
              <div class="user-dropdown-info">
                <h4 id="userDropdownName">John Doe</h4>
                <p id="userDropdownEmail">admin@calpro.com</p>
                <span class="user-badge">Lead Calibrator</span>
              </div>
            </div>
            <div class="user-dropdown-content">
              <a href="javascript:void(0)" class="dropdown-menu-item" id="profileLink">
                <i class="fas fa-user"></i>
                <span>My Profile</span>
              </a>
              <a href="#activity" class="dropdown-menu-item">
                <i class="fas fa-history"></i>
                <span>Activity Log</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="#help" class="dropdown-menu-item">
                <i class="fas fa-question-circle"></i>
                <span>Help & Support</span>
              </a>
              <a href="#logout" class="dropdown-menu-item danger">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Section -->
    <section class="content-section active" id="dashboard">
      <!-- Enhanced Dashboard Header -->
      <div class="dashboard-header-enhanced">
        <div class="header-main">
          <div class="header-title-group">
            <h1><i class="fas fa-gauge-high"></i> Field Calibration Dashboard</h1>
            <p class="dashboard-subtitle">Real-time overview of calibration activities and equipment status</p>
          </div>
          <div class="header-actions-group">
            <button class="btn btn-primary btn-large" id="newWorksheetBtn" onclick="window.location.hash='worksheets'">
              <i class="fas fa-plus-circle"></i>
              <span>New Worksheet</span>
            </button>
            <button class="btn btn-secondary" id="quickScanBtn" onclick="openQuickScanModal()">
              <i class="fas fa-qrcode"></i>
              <span>Quick Scan</span>
            </button>
            <button class="btn btn-outline" id="exportDataBtn" onclick="openExportModal()">
              <i class="fas fa-download"></i>
              <span>Export</span>
            </button>
          </div>
        </div>
        
        <!-- Quick Stats Bar -->
        <div class="quick-stats-bar">
          <div class="quick-stat-item">
            <i class="fas fa-calendar-day"></i>
            <div class="quick-stat-content">
              <span class="quick-stat-value" id="todayCount">0</span>
              <span class="quick-stat-label">Today's Calibrations</span>
            </div>
          </div>
          <div class="quick-stat-divider"></div>
          <div class="quick-stat-item">
            <i class="fas fa-clock"></i>
            <div class="quick-stat-content">
              <span class="quick-stat-value" id="weeklyCount">0</span>
              <span class="quick-stat-label">This Week</span>
            </div>
          </div>
          <div class="quick-stat-divider"></div>
          <div class="quick-stat-item warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="quick-stat-content">
              <span class="quick-stat-value" id="overdueCount">0</span>
              <span class="quick-stat-label">Overdue</span>
            </div>
          </div>
          <div class="quick-stat-divider"></div>
          <div class="quick-stat-item">
            <i class="fas fa-check-circle"></i>
            <div class="quick-stat-content">
              <span class="quick-stat-value" id="completedToday">0</span>
              <span class="quick-stat-label">Completed Today</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Worksheet Creation Section -->
      <div class="task-bar-section" id="worksheetSection">
        <div class="section-title-bar">
          <h2><i class="fas fa-file-circle-plus"></i> Quick Worksheet Creation</h2>
          <p class="section-subtitle">Select equipment category to start a new calibration worksheet</p>
        </div>

        <div class="worksheet-templates-grid">
          <!-- Pressure Equipment -->
          <div class="worksheet-template-card" onclick="showPressureTemplates()">
            <div class="template-icon pressure-icon">
              <i class="fas fa-gauge-high"></i>
            </div>
            <div class="template-content">
              <h3>Pressure Equipment</h3>
              <p>Gauges, Transmitters, Calibrators, Vacuum</p>
              <div class="template-count">
                <i class="fas fa-file-lines"></i>
                <span>14 templates</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>

          <!-- Temperature Equipment -->
          <div class="worksheet-template-card" onclick="window.location.hash='worksheets'">
            <div class="template-icon temperature-icon">
              <i class="fas fa-thermometer-half"></i>
            </div>
            <div class="template-content">
              <h3>Temperature Equipment</h3>
              <p>RTDs, Thermocouples, Transmitters, Calibrators</p>
              <div class="template-count">
                <i class="fas fa-file-lines"></i>
                <span>Create custom</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>

          <!-- Electrical Equipment -->
          <div class="worksheet-template-card" onclick="window.location.hash='worksheets'">
            <div class="template-icon electrical-icon">
              <i class="fas fa-bolt"></i>
            </div>
            <div class="template-content">
              <h3>Electrical Equipment</h3>
              <p>DMMs, Meggers, Oscilloscopes, Power Meters</p>
              <div class="template-count">
                <i class="fas fa-file-lines"></i>
                <span>Create custom</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>

          <!-- Mechanical Equipment -->
          <div class="worksheet-template-card" onclick="window.location.hash='worksheets'">
            <div class="template-icon mechanical-icon">
              <i class="fas fa-cog"></i>
            </div>
            <div class="template-content">
              <h3>Mechanical Equipment</h3>
              <p>Torque Tools, Force Gauges, Scales, Tachometers</p>
              <div class="template-count">
                <i class="fas fa-file-lines"></i>
                <span>Create custom</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>

          <!-- Dimensional Equipment -->
          <div class="worksheet-template-card" onclick="window.location.hash='worksheets'">
            <div class="template-icon dimensional-icon">
              <i class="fas fa-ruler"></i>
            </div>
            <div class="template-content">
              <h3>Dimensional Equipment</h3>
              <p>Micrometers, Calipers, Gage Blocks, Indicators</p>
              <div class="template-count">
                <i class="fas fa-file-lines"></i>
                <span>Create custom</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>

          <!-- Custom/Other Equipment -->
          <div class="worksheet-template-card" onclick="window.location.hash='worksheets'">
            <div class="template-icon custom-icon">
              <i class="fas fa-plus-circle"></i>
            </div>
            <div class="template-content">
              <h3>Custom Worksheet</h3>
              <p>Create blank worksheet for specialized equipment</p>
              <div class="template-count">
                <i class="fas fa-file-circle-plus"></i>
                <span>Start from scratch</span>
              </div>
            </div>
            <div class="template-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Worksheets & Certificates -->
      <div class="dashboard-grid">
        <div class="dashboard-card full-width">
          <div class="card-header">
            <h3><i class="fas fa-clock-rotate-left"></i> Recent Worksheets & Certificates</h3>
            <button class="btn btn-link" id="viewAllBtn" onclick="window.location.hash='certificates'">
              View All <i class="fas fa-arrow-right"></i>
            </button>
          </div>
          <div class="card-content">
            <div class="recent-worksheets-list">
              <!-- Dynamic content loaded by JavaScript -->
              <div style="text-align: center; padding: 40px 20px; color: #999;">
                <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 12px;"></i>
                <p>Loading recent worksheets...</p>
              </div>
              <!-- Hardcoded items hidden - now loaded dynamically by JavaScript -->
              <div style="display:none;">
              <div class="worksheet-item status-completed">
                <div class="worksheet-status-indicator"></div>
                <div class="worksheet-icon">
                  <i class="fas fa-gauge-high"></i>
                </div>
                <div class="worksheet-info">
                  <h4>Pressure Transmitter - Rosemount 3051</h4>
                  <p class="worksheet-details">
                    <span><i class="fas fa-hashtag"></i> P-2025-001</span>
                    <span><i class="fas fa-building"></i> Ghana Oil Company</span>
                    <span><i class="fas fa-calendar"></i> Oct 14, 2025</span>
                  </p>
                </div>
                <div class="worksheet-status-badge status-completed">
                  <i class="fas fa-check-circle"></i> Completed
                </div>
                <div class="worksheet-actions">
                  <button class="action-btn" title="View Certificate">
                    <i class="fas fa-file-pdf"></i>
                  </button>
                  <button class="action-btn" title="Duplicate">
                    <i class="fas fa-copy"></i>
                  </button>
                  <button class="action-btn" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </div>

              <!-- Worksheet Item 2 -->
              <div class="worksheet-item status-draft">
                <div class="worksheet-status-indicator"></div>
                <div class="worksheet-icon">
                  <i class="fas fa-thermometer-half"></i>
                </div>
                <div class="worksheet-info">
                  <h4>Temperature Sensor - Pt100 RTD</h4>
                  <p class="worksheet-details">
                    <span><i class="fas fa-hashtag"></i> P-2025-002</span>
                    <span><i class="fas fa-building"></i> Food Processing Ltd</span>
                    <span><i class="fas fa-calendar"></i> Oct 14, 2025</span>
                  </p>
                </div>
                <div class="worksheet-status-badge status-draft">
                  <i class="fas fa-pen"></i> Draft
                </div>
                <div class="worksheet-actions">
                  <button class="action-btn primary" title="Continue" onclick="window.location.hash='certificates'">
                    <i class="fas fa-play"></i>
                  </button>
                  <button class="action-btn" title="Duplicate">
                    <i class="fas fa-copy"></i>
                  </button>
                  <button class="action-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>

              <!-- Worksheet Item 3 -->
              <div class="worksheet-item status-pending">
                <div class="worksheet-status-indicator"></div>
                <div class="worksheet-icon">
                  <i class="fas fa-bolt"></i>
                </div>
                <div class="worksheet-info">
                  <h4>Digital Multimeter - Fluke 87V</h4>
                  <p class="worksheet-details">
                    <span><i class="fas fa-hashtag"></i> P-2025-003</span>
                    <span><i class="fas fa-building"></i> Mining Operations Ghana</span>
                    <span><i class="fas fa-calendar"></i> Oct 13, 2025</span>
                  </p>
                </div>
                <div class="worksheet-status-badge status-pending">
                  <i class="fas fa-hourglass-half"></i> Pending Review
                </div>
                <div class="worksheet-actions">
                  <button class="action-btn" title="View">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="action-btn" title="Approve">
                    <i class="fas fa-check"></i>
                  </button>
                  <button class="action-btn" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </div>

              <!-- Worksheet Item 4 -->
              <div class="worksheet-item status-completed">
                <div class="worksheet-status-indicator"></div>
                <div class="worksheet-icon">
                  <i class="fas fa-ruler"></i>
                </div>
                <div class="worksheet-info">
                  <h4>Digital Caliper - Mitutoyo 500-196</h4>
                  <p class="worksheet-details">
                    <span><i class="fas fa-hashtag"></i> P-2025-004</span>
                    <span><i class="fas fa-building"></i> Manufacturing Corp</span>
                    <span><i class="fas fa-calendar"></i> Oct 13, 2025</span>
                  </p>
                </div>
                <div class="worksheet-status-badge status-completed">
                  <i class="fas fa-check-circle"></i> Completed
                </div>
                <div class="worksheet-actions">
                  <button class="action-btn" title="View Certificate">
                    <i class="fas fa-file-pdf"></i>
                  </button>
                  <button class="action-btn" title="Duplicate">
                    <i class="fas fa-copy"></i>
                  </button>
                  <button class="action-btn" title="Email">
                    <i class="fas fa-envelope"></i>
                  </button>
                </div>
              </div>

              <!-- Worksheet Item 5 -->
              <div class="worksheet-item status-completed">
                <div class="worksheet-status-indicator"></div>
                <div class="worksheet-icon">
                  <i class="fas fa-weight-hanging"></i>
                </div>
                <div class="worksheet-info">
                  <h4>Platform Scale - 500kg</h4>
                  <p class="worksheet-details">
                    <span><i class="fas fa-hashtag"></i> P-2025-005</span>
                    <span><i class="fas fa-building"></i> Logistics Ghana</span>
                    <span><i class="fas fa-calendar"></i> Oct 12, 2025</span>
                  </p>
                </div>
                <div class="worksheet-status-badge status-completed">
                  <i class="fas fa-check-circle"></i> Completed
                </div>
                <div class="worksheet-actions">
                  <button class="action-btn" title="View Certificate">
                    <i class="fas fa-file-pdf"></i>
                  </button>
                  <button class="action-btn" title="Duplicate">
                    <i class="fas fa-copy"></i>
                  </button>
              </div>
              <!-- End of hidden hardcoded items -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Worksheets Section -->
    <section class="content-section" id="worksheets">
      <!-- Worksheet Header -->
      <div class="certificate-header">
        <div class="header-content">
          <h1><i class="fas fa-file-lines"></i> Calibration Worksheets</h1>
          <p class="header-subtitle">Create and manage calibration worksheets for field work</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-modern" onclick="showWorksheetList(); loadWorksheetCards(); updateDashboardStats();">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Dashboard</span>
          </button>
          <button class="btn btn-secondary btn-modern" onclick="loadWorksheetCards(); updateDashboardStats();" title="Refresh worksheets">
            <i class="fas fa-sync"></i>
            <span>Refresh</span>
          </button>
          <button class="btn btn-primary btn-modern" onclick="showWorksheetForm()">
            <i class="fas fa-plus"></i>
            <span>New Worksheet</span>
          </button>
        </div>
      </div>

      <!-- Worksheet Type Selector (Initially Shown) -->
      <div id="worksheetTypeSelector" style="display:none">
        <div class="type-selector-container">
          <div class="type-selector-header">
            <h2><i class="fas fa-clipboard-list"></i> Select Worksheet Type</h2>
            <p>Choose the type of equipment you're calibrating to start the appropriate worksheet</p>
          </div>

          <div class="worksheet-type-grid">
            <!-- Pressure Equipment -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('pressure')">
              <div class="type-icon pressure-bg">
                <i class="fas fa-gauge-high"></i>
              </div>
              <h3>Pressure Equipment</h3>
              <p class="type-description">Gauges, Transmitters, Calibrators, Vacuum, Switches</p>
              <ul class="equipment-examples">
                <li>Pressure Transmitters (0-100 to 5000 psi)</li>
                <li>Analog & Digital Gauges</li>
                <li>Differential Pressure</li>
                <li>Vacuum Gauges</li>
                <li>Compound Gauges</li>
              </ul>
              <div class="type-badge">14 Templates Available</div>
            </div>

            <!-- Temperature Equipment -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('temperature')">
              <div class="type-icon temperature-bg">
                <i class="fas fa-thermometer-half"></i>
              </div>
              <h3>Temperature Equipment</h3>
              <p class="type-description">RTDs, Thermocouples, Transmitters, Calibrators</p>
              <ul class="equipment-examples">
                <li>PT100/PT1000 RTDs</li>
                <li>Type K, J, T Thermocouples</li>
                <li>Temperature Transmitters</li>
                <li>Dry Block Calibrators</li>
                <li>Temperature Indicators</li>
              </ul>
              <div class="type-badge">Custom Worksheet</div>
            </div>

            <!-- Electrical Equipment -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('electrical')">
              <div class="type-icon electrical-bg">
                <i class="fas fa-bolt"></i>
              </div>
              <h3>Electrical Equipment</h3>
              <p class="type-description">DMMs, Meggers, Oscilloscopes, Power Meters</p>
              <ul class="equipment-examples">
                <li>Digital Multimeters (Fluke, Keysight)</li>
                <li>Insulation Resistance Testers</li>
                <li>Clamp Meters</li>
                <li>Power Quality Analyzers</li>
                <li>Function Generators</li>
              </ul>
              <div class="type-badge">Custom Worksheet</div>
            </div>

            <!-- Mechanical Equipment -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('mechanical')">
              <div class="type-icon mechanical-bg">
                <i class="fas fa-cog"></i>
              </div>
              <h3>Mechanical Equipment</h3>
              <p class="type-description">Torque Tools, Force Gauges, Scales, Tachometers</p>
              <ul class="equipment-examples">
                <li>Torque Wrenches (5-500 Nm)</li>
                <li>Force Gauges</li>
                <li>Industrial Scales</li>
                <li>Tachometers & Speed Meters</li>
                <li>Load Cells</li>
              </ul>
              <div class="type-badge">Custom Worksheet</div>
            </div>

            <!-- Dimensional Equipment -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('dimensional')">
              <div class="type-icon dimensional-bg">
                <i class="fas fa-ruler"></i>
              </div>
              <h3>Dimensional Equipment</h3>
              <p class="type-description">Micrometers, Calipers, Gage Blocks, Indicators</p>
              <ul class="equipment-examples">
                <li>Digital Calipers (Mitutoyo, Starrett)</li>
                <li>Micrometers (0-25mm to 100-125mm)</li>
                <li>Gage Block Sets</li>
                <li>Height Gauges</li>
                <li>Dial Indicators</li>
              </ul>
              <div class="type-badge">Custom Worksheet</div>
            </div>

            <!-- Custom/Other -->
            <div class="worksheet-type-card" onclick="selectWorksheetType('custom')">
              <div class="type-icon custom-bg">
                <i class="fas fa-plus-circle"></i>
              </div>
              <h3>Custom/Other Equipment</h3>
              <p class="type-description">Create blank worksheet for specialized equipment</p>
              <ul class="equipment-examples">
                <li>Flow Meters</li>
                <li>Level Instruments</li>
                <li>Analytical Equipment</li>
                <li>Environmental Chambers</li>
                <li>Any specialized equipment</li>
              </ul>
              <div class="type-badge">Blank Template</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Worksheet Form (Initially Hidden) -->
      <div id="worksheetFormContainer" style="display:none">
        <div class="form-progress">
          <div class="progress-step active" data-step="0">Worksheet Type</div>
          <div class="progress-step" data-step="1">Equipment Details</div>
          <div class="progress-step" data-step="2">Test Results</div>
          <div class="progress-step" data-step="3">Review & Sign</div>
        </div>

        <div class="form-step active" data-step="1">
          <h2>ðŸ“‹ Equipment Details & Specifications</h2>
          <div class="selected-worksheet-type" id="selectedWorksheetType" style="margin-bottom: 20px; padding: 12px; background: var(--card-header-bg); border-left: 4px solid var(--calpro-gold); border-radius: 8px;">
            <strong style="color: var(--text-primary);">Worksheet Type:</strong> <span id="worksheetTypeDisplay" style="color: var(--text-secondary);">Not Selected</span>
            <button onclick="changeWorksheetType()" style="float: right; padding: 4px 12px; background: var(--bg-dark-secondary); border: 1px solid var(--calpro-gold); color: var(--calpro-gold); border-radius: 4px; cursor: pointer; transition: all 0.3s;">Change Type</button>
          </div>
          <div class="equipment-grid">
            <label>Equipment Description
              <input id="ws_equipDesc" placeholder="Digital Electronic Scale" required>
            </label>
            <label>Manufacturer
              <input id="ws_manufacturer" placeholder="Prochef" required>
            </label>
            <label>Model Number
              <input id="ws_equipModel" placeholder="Model XYZ-100" required>
            </label>
            <label>Serial Number
              <input id="ws_serialNo" placeholder="SN123456">
            </label>
            <label>Type / Range
              <input id="ws_typeRange" placeholder="0-100 psi">
            </label>
            <label>Accuracy
              <input id="ws_accuracy" placeholder="Â±0.5%">
            </label>
            <label>Location
              <input id="ws_location" placeholder="Plant A - Production Floor">
            </label>
            <label>Asset/Tag Number
              <input id="ws_assetNo" placeholder="TAG-001">
            </label>
          </div>

          <h3>ðŸ“ Customer Information</h3>
          <div class="equipment-grid">
            <label>Customer Name
              <input id="ws_customer" placeholder="Ghana Oil Company" required>
            </label>
            <label>Site Location
              <input id="ws_site" placeholder="Tema Refinery">
            </label>
            <label>Contact Person
              <input id="ws_contact" placeholder="John Mensah">
            </label>
            <label>Phone/Email
              <input id="ws_contactInfo" placeholder="+233 24 123 4567">
            </label>
          </div>

          <h3>ðŸ”¬ Calibration Standards</h3>
          <div class="equipment-grid">
            <label>Reference Standard
              <input id="ws_refStandard" placeholder="Fluke 718 Pressure Calibrator">
            </label>
            <label>Certificate Number
              <input id="ws_refCertNo" placeholder="CAL-2024-001">
            </label>
            <label>Calibration Date
              <input type="date" id="ws_refCalDate">
            </label>
            <label>Recalibration Due
              <input type="date" id="ws_refDueDate">
            </label>
          </div>
          
          <div class="step-actions">
            <button class="btn-primary" onclick="nextWorksheetStep()">Next: Test Results â†’</button>
          </div>
        </div>

        <div class="form-step" data-step="2">
          <h2>ðŸ”¬ Calibration Test Results</h2>
          <div class="test-controls">
            <button id="ws_addRow" class="btn-secondary" onclick="addWorksheetTestRow()">+ Add Test Point</button>
            <button id="ws_addSetTemplate" class="btn-secondary" onclick="addWorksheetStandardSet()">Add Standard Set</button>
            <button id="ws_calculateUncertainty" class="btn-secondary" onclick="calculateWorksheetUncertainty()">Calculate Uncertainty</button>
          </div>
          
          <div class="table-container">
            <table id="ws_resultsTable" class="results-table">
              <thead>
                <tr>
                  <th>Reference Value</th>
                  <th>Direction</th>
                  <th>Measured Value</th>
                  <th>Deviation</th>
                  <th>% Error</th>
                  <th>Uncertainty</th>
                  <th>Pass/Fail</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          
          <div class="results-summary">
            <h3>ðŸ“ˆ Test Summary</h3>
            <div class="summary-stats">
              <div class="stat-item">
                <span class="stat-label">Total Points:</span>
                <span id="ws_totalPoints" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Passed:</span>
                <span id="ws_passedPoints" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Failed:</span>
                <span id="ws_failedPoints" class="stat-value">0</span>
              </div>
            </div>
          </div>
          
          <div class="step-actions">
            <button class="btn-secondary" onclick="prevWorksheetStep()">â† Previous</button>
            <button class="btn-primary" onclick="nextWorksheetStep()">Next: Review â†’</button>
          </div>
        </div>

        <div class="form-step" data-step="3">
          <h2>âœ… Review & Complete Worksheet</h2>
          
          <div class="review-section">
            <h3>Equipment Summary</h3>
            <div id="ws_equipmentSummary" class="summary-grid"></div>
          </div>
          
          <div class="review-section">
            <h3>Test Results Summary</h3>
            <div id="ws_resultsSummary"></div>
          </div>

          <div class="signature-section">
            <h3>ðŸ“ Technician Sign-off</h3>
            <div class="equipment-grid">
              <label>Calibrated By
                <input id="ws_calibratedBy" placeholder="Your Name">
              </label>
              <label>Date
                <input type="date" id="ws_calibrationDate">
              </label>
              <label>Comments/Observations
                <textarea id="ws_comments" rows="3" placeholder="Any observations during calibration..."></textarea>
              </label>
            </div>
          </div>
          
          <div class="step-actions">
            <button class="btn-secondary" onclick="prevWorksheetStep()">â† Previous</button>
            <button class="btn-secondary" onclick="saveWorksheetDraft()">ðŸ’¾ Save as Draft</button>
            <button class="btn-success" onclick="completeWorksheet()">âœ“ Complete Worksheet</button>
          </div>
        </div>
      </div>

      <!-- Worksheet List View (Default) -->
      <div id="worksheetListContainer">
        <div class="filters-bar">
          <div class="filter-group">
            <input type="search" id="worksheetSearch" placeholder="ðŸ” Search worksheets..." class="search-input">
            <select id="statusFilter" class="filter-select">
              <option value="">All Status</option>
              <option value="draft">Draft</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="pending-review">Pending Review</option>
            </select>
            <select id="equipmentTypeFilter" class="filter-select">
              <option value="">All Equipment Types</option>
              <option value="pressure">Pressure</option>
              <option value="temperature">Temperature</option>
              <option value="electrical">Electrical</option>
              <option value="mechanical">Mechanical</option>
              <option value="dimensional">Dimensional</option>
            </select>
          </div>
          <div class="view-toggle">
            <button class="view-btn active" data-view="grid"><i class="fas fa-grip"></i></button>
            <button class="view-btn" data-view="list"><i class="fas fa-list"></i></button>
          </div>
        </div>

        <div class="worksheets-grid" id="worksheetsGrid">
          <!-- Sample Worksheet Cards -->
          <div class="worksheet-card status-completed">
            <div class="worksheet-card-header">
              <div class="status-badge status-completed">
                <i class="fas fa-check-circle"></i> Completed
              </div>
              <div class="worksheet-menu">
                <button class="menu-btn"><i class="fas fa-ellipsis-v"></i></button>
              </div>
            </div>
            <div class="worksheet-card-content">
              <div class="equipment-icon">
                <i class="fas fa-gauge"></i>
              </div>
              <h3>Rosemount 3051 Pressure Transmitter</h3>
              <p class="worksheet-meta">
                <span><i class="fas fa-hashtag"></i> WS-2025-001</span>
                <span><i class="fas fa-building"></i> Ghana Oil Company</span>
              </p>
              <p class="worksheet-details">
                <span><i class="fas fa-calendar"></i> Oct 14, 2025</span>
                <span><i class="fas fa-user"></i> John Doe</span>
              </p>
            </div>
            <div class="worksheet-card-footer">
              <button class="btn-sm btn-primary" onclick="viewWorksheet('ws-001')">
                <i class="fas fa-eye"></i> View
              </button>
              <button class="btn-sm btn-secondary" onclick="convertToCertificate('ws-001')">
                <i class="fas fa-certificate"></i> Issue Certificate
              </button>
            </div>
          </div>

          <div class="worksheet-card status-draft">
            <div class="worksheet-card-header">
              <div class="status-badge status-draft">
                <i class="fas fa-file-circle-plus"></i> Draft
              </div>
              <div class="worksheet-menu">
                <button class="menu-btn"><i class="fas fa-ellipsis-v"></i></button>
              </div>
            </div>
            <div class="worksheet-card-content">
              <div class="equipment-icon">
                <i class="fas fa-thermometer-half"></i>
              </div>
              <h3>Pt100 RTD Temperature Sensor</h3>
              <p class="worksheet-meta">
                <span><i class="fas fa-hashtag"></i> WS-2025-002</span>
                <span><i class="fas fa-building"></i> Food Processing Ltd</span>
              </p>
              <p class="worksheet-details">
                <span><i class="fas fa-calendar"></i> Oct 14, 2025</span>
                <span><i class="fas fa-user"></i> Jane Smith</span>
              </p>
            </div>
            <div class="worksheet-card-footer">
              <button class="btn-sm btn-primary" onclick="continueWorksheet('ws-002')">
                <i class="fas fa-play"></i> Continue
              </button>
              <button class="btn-sm btn-danger" onclick="deleteWorksheet('ws-002')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </div>
          </div>

          <div class="worksheet-card status-pending">
            <div class="worksheet-card-header">
              <div class="status-badge status-pending">
                <i class="fas fa-hourglass-half"></i> Pending Review
              </div>
              <div class="worksheet-menu">
                <button class="menu-btn"><i class="fas fa-ellipsis-v"></i></button>
              </div>
            </div>
            <div class="worksheet-card-content">
              <div class="equipment-icon">
                <i class="fas fa-bolt"></i>
              </div>
              <h3>Fluke 87V Digital Multimeter</h3>
              <p class="worksheet-meta">
                <span><i class="fas fa-hashtag"></i> WS-2025-003</span>
                <span><i class="fas fa-building"></i> Mining Operations</span>
              </p>
              <p class="worksheet-details">
                <span><i class="fas fa-calendar"></i> Oct 13, 2025</span>
                <span><i class="fas fa-user"></i> Robert Johnson</span>
              </p>
            </div>
            <div class="worksheet-card-footer">
              <button class="btn-sm btn-primary" onclick="viewWorksheet('ws-003')">
                <i class="fas fa-eye"></i> Review
              </button>
              <button class="btn-sm btn-success" onclick="approveWorksheet('ws-003')">
                <i class="fas fa-check"></i> Approve
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Certificate Creation Section -->
    <section class="content-section" id="certificate-creation">
      <!-- Modern Header with Progress -->
      <div class="certificate-header">
        <div class="header-content">
          <h1><i class="fas fa-certificate"></i> Create New Calibration Certificate</h1>
          <p class="header-subtitle">Complete the form below to generate a professional calibration certificate</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-modern" id="loadTemplateBtn">
            <i class="fas fa-file-import"></i>
            <span>Load Template</span>
          </button>
          <button class="btn btn-primary btn-modern" id="saveDraftBtn">
            <i class="fas fa-save"></i>
            <span>Save Draft</span>
          </button>
        </div>
      </div>

      <!-- Progress Steps -->
      <div class="progress-wizard">
        <div class="progress-step active" data-step="1">
          <div class="step-circle">
            <i class="fas fa-tools"></i>
            <span class="step-num">1</span>
          </div>
          <div class="step-label">Equipment</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="2">
          <div class="step-circle">
            <i class="fas fa-user"></i>
            <span class="step-num">2</span>
          </div>
          <div class="step-label">Customer</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="3">
          <div class="step-circle">
            <i class="fas fa-clipboard-check"></i>
            <span class="step-num">3</span>
          </div>
          <div class="step-label">Calibration</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step" data-step="4">
          <div class="step-circle">
            <i class="fas fa-check-circle"></i>
            <span class="step-num">4</span>
          </div>
          <div class="step-label">Review</div>
        </div>
      </div>

      <!-- Multi-step Form -->
      <div class="form-wizard-modern">
        <!-- Step 1: Equipment Details -->
        <div class="step-content active" id="step1" data-step="1">
          <div class="form-card">
            <div class="card-header">
              <h2><i class="fas fa-cog"></i> Equipment Information</h2>
              <p>Specify the equipment details and identification</p>
            </div>
            <div class="card-body">
              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-barcode"></i> Certificate Number</label>
                  <input id="certNo" placeholder="P..." required>
                  <small class="form-hint">Format: P... (e.g., P-001-2025)</small>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-check-circle"></i> Traceable</label>
                  <select id="traceable">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-certificate"></i> Accredited</label>
                  <select id="accredited">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-wrench"></i> Equipment Type/Description</label>
                  <select id="instrumentType" required>
                    <optgroup label="Pressure Equipment">
                      <option value="pressure_gauge">Pressure Gauge Worksheet</option>
                      <option value="pressure_transmitter">Pressure Transmitter/Transducer Worksheet</option>
                      <option value="pressure_calibrator">Pressure Calibrator Worksheet</option>
                      <option value="differential_pressure">Differential Pressure Gauge</option>
                    </optgroup>
                    <optgroup label="Temperature Equipment">
                      <option value="temperature_block">Temperature Block Calibrator</option>
                      <option value="temperature_sensor">Temperature Sensor</option>
                      <option value="thermometer">Thermometer</option>
                      <option value="thermocouple">Thermocouple</option>
                      <option value="temperature_transmitter">Temperature Transmitter</option>
                    </optgroup>
                    <optgroup label="Electrical Equipment">
                      <option value="multifunction_calibrator">Multi-Function Calibrator Worksheet</option>
                      <option value="digital_multimeter">Digital Multimeter</option>
                      <option value="oscilloscope">Oscilloscope</option>
                      <option value="power_meter">Power Meter</option>
                      <option value="insulation_tester">Insulation Tester</option>
                    </optgroup>
                    <optgroup label="Mechanical Equipment">
                      <option value="resistance_decade">Resistance / Decade Box Worksheet</option>
                      <option value="torque_wrench">Torque Wrench</option>
                      <option value="force_gauge">Force Gauge</option>
                      <option value="weight_scale">Weight Scale</option>
                    </optgroup>
                    <optgroup label="Dimension Equipment">
                      <option value="digital_caliper">Digital Caliper</option>
                      <option value="micrometer">Micrometer</option>
                      <option value="gauge_block">Gauge Block</option>
                      <option value="dial_indicator">Dial Indicator</option>
                      <option value="height_gauge">Height Gauge</option>
                      <option value="vernier_caliper">Vernier Caliper</option>
                    </optgroup>
                  </select>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-industry"></i> Manufacturer</label>
                  <input id="manufacturer" placeholder="Seimens MCS" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-tag"></i> Type/Model</label>
                  <input id="model" placeholder="MCS + 1051 + ACPF000.4" required>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-hashtag"></i> Serial Number</label>
                  <input id="serialNumber" placeholder="25515537 + 4330F12 + 97N6412" required>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-ruler"></i> Range</label>
                  <input id="equipmentRange" placeholder="0-100 psi">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-crosshairs"></i> Resolution</label>
                  <input id="resolution" placeholder="0.01">
                </div>

                <div class="form-group">
                  <label><i class="fas fa-check"></i> Accuracy</label>
                  <input id="accuracy" placeholder="Â±0.1%">
                </div>

                <div class="form-group">
                  <label><i class="fas fa-star"></i> Asset Number</label>
                  <input id="assetNumber" placeholder="Asset ID">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-calendar"></i> Job Number</label>
                  <input id="jobNumber" placeholder="Job/Work Order Number">
                </div>

                <div class="form-group">
                  <label><i class="fas fa-calendar-check"></i> Date Received</label>
                  <input type="date" id="dateReceived">
                </div>

                <div class="form-group">
                  <label><i class="fas fa-calendar-times"></i> Date Calibrated</label>
                  <input type="date" id="dateCalibrated">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Customer Information -->
        <div class="step-content" id="step2" data-step="2">
          <div class="form-card">
            <div class="card-header">
              <h2><i class="fas fa-building"></i> Customer Information</h2>
              <p>Enter customer location and contact details</p>
            </div>
            <div class="card-body">
              <div class="form-row">
                <div class="form-group full-width">
                  <label><i class="fas fa-building"></i> Customer</label>
                  <input id="customer" placeholder="Sinopec Ghana" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group full-width">
                  <label><i class="fas fa-map-marker-alt"></i> Address / IGL</label>
                  <textarea id="customerAddress" placeholder="P.O. Box AN 5789, Accra-North / GPS Address" rows="3" required></textarea>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group full-width">
                  <label><i class="fas fa-envelope"></i> Contact / Email</label>
                  <input id="contactEmail" placeholder="contact@company.com">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group full-width">
                  <label><i class="fas fa-comment-alt"></i> Remarks</label>
                  <textarea id="remarks" placeholder="Additional notes or special instructions" rows="3"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Calibration Data -->
        <div class="step-content" id="step3" data-step="3">
          <div class="form-card">
            <div class="card-header">
              <h2><i class="fas fa-calendar-alt"></i> Calibration Details</h2>
              <p>Record calibration dates and environmental conditions</p>
            </div>
            <div class="card-body">
              <div class="form-row">
                <div class="form-group">
                  <label><i class="fas fa-calendar-check"></i> Calibration Date</label>
                  <input type="date" id="calibrationDate" required>
                </div>
                
                <div class="form-group">
                  <label><i class="fas fa-calendar-times"></i> Due Date</label>
                  <input type="date" id="dueDate" required>
                </div>
                
                <div class="form-group">
                  <label><i class="fas fa-user-check"></i> Calibrated By</label>
                  <input id="calibratedBy" placeholder="Technician Name" required>
                </div>
              </div>

              <div class="environmental-conditions">
                <h3><i class="fas fa-cloud"></i> Environmental Conditions</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label><i class="fas fa-thermometer-half"></i> Temperature (Â°C)</label>
                    <div class="input-group">
                      <input type="number" id="temperature" placeholder="20Â±1" step="0.1">
                      <span class="input-addon">Actual / Specified</span>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label><i class="fas fa-tint"></i> Humidity (%)</label>
                    <div class="input-group">
                      <input type="number" id="humidity" placeholder="60%Â±20%" step="0.1">
                      <span class="input-addon">Actual / Specified</span>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label><i class="fas fa-compress-arrows-alt"></i> Atmospheric Pressure</label>
                    <input type="text" id="pressure" placeholder="101.3 kPa">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Measurement Data Table -->
          <div class="form-card measurement-card">
            <div class="card-header">
              <h2><i class="fas fa-table"></i> Measurement Data</h2>
              <button type="button" class="btn btn-primary btn-modern" id="addMeasurementBtn">
                <i class="fas fa-plus"></i>
                <span>Add Measurement</span>
              </button>
            </div>
            <div class="card-body"</div>
              <div class="table-responsive">
                <div class="measurement-type-selector">
                  <label><i class="fas fa-sliders-h"></i> Measurement Type:</label>
                  <select id="measurementType">
                    <option value="pressure">Pressure (Ref/UUT Pressure, Rising/Falling)</option>
                    <option value="voltage">Voltage (UUT Voltage, Rising/Falling)</option>
                    <option value="current">Current (Mean Ref Pressure, Mean UUT, UUT Current mA)</option>
                    <option value="standard">Standard (Standard Value, Instrument Reading, Error, Uncertainty)</option>
                  </select>
                </div>

                <table id="measurementTable" class="modern-table">
                  <thead>
                    <tr>
                      <th rowspan="2"><i class="fas fa-percentage"></i> % Point</th>
                      <th colspan="2"><i class="fas fa-arrow-up"></i> Ref Pressure</th>
                      <th colspan="2"><i class="fas fa-gauge"></i> UUT Pressure</th>
                      <th colspan="2"><i class="fas fa-bolt"></i> UUT Voltage (V)</th>
                      <th rowspan="2"><i class="fas fa-cog"></i> Actions</th>
                    </tr>
                    <tr>
                      <th>Rising</th>
                      <th>Falling</th>
                      <th>Rising</th>
                      <th>Falling</th>
                      <th>Rising</th>
                      <th>Falling</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" value="0" class="table-input" readonly></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td>
                        <button type="button" class="btn-icon btn-danger" onclick="removeRow(this)" title="Remove row">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><input type="text" value="25%" class="table-input" readonly></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td>
                        <button type="button" class="btn-icon btn-danger" onclick="removeRow(this)" title="Remove row">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><input type="text" value="50%" class="table-input" readonly></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td>
                        <button type="button" class="btn-icon btn-danger" onclick="removeRow(this)" title="Remove row">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><input type="text" value="75%" class="table-input" readonly></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td>
                        <button type="button" class="btn-icon btn-danger" onclick="removeRow(this)" title="Remove row">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td><input type="text" value="100%" class="table-input" readonly></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td><input type="number" step="0.01" placeholder="0.00" class="table-input"></td>
                      <td>
                        <button type="button" class="btn-icon btn-danger" onclick="removeRow(this)" title="Remove row">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>

                <div class="calibrator-section">
                  <div class="form-row">
                    <div class="form-group">
                      <label><i class="fas fa-user-check"></i> Calibrated by</label>
                      <input id="calBy" placeholder="F. Aidoo [ ]">
                    </div>
                    <div class="form-group">
                      <label><i class="fas fa-user-tie"></i> Verified by</label>
                      <input id="verifiedBy" placeholder="John Doe [ ]">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: Review & Generate -->
        <div class="step-content" id="step4" data-step="4">
          <div class="form-card review-card">
            <div class="card-header">
              <h2><i class="fas fa-check-double"></i> Review & Generate Certificate</h2>
              <p>Review all information before generating the certificate</p>
            </div>
            <div class="card-body">
              <div class="preview-section">
                <div id="certificatePreview" class="certificate-preview-box">
                  <div class="preview-placeholder">
                    <i class="fas fa-file-certificate"></i>
                    <p>Click "Preview Certificate" to see a preview</p>
                  </div>
                </div>
              </div>
              
              <div class="action-buttons">
                <button type="button" class="btn btn-secondary btn-modern btn-lg" id="previewBtn">
                  <i class="fas fa-eye"></i>
                  <span>Preview Certificate</span>
                </button>
                <button type="button" class="btn btn-success btn-modern btn-lg" id="generateBtn">
                  <i class="fas fa-file-pdf"></i>
                  <span>Generate PDF Certificate</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Wizard Navigation -->
        <div class="wizard-navigation-modern">
          <button type="button" class="btn btn-secondary btn-modern btn-nav" id="prevBtn" style="display: none;">
            <i class="fas fa-arrow-left"></i>
            <span>Previous</span>
          </button>
          <button type="button" class="btn btn-primary btn-modern btn-nav" id="nextBtn">
            <span>Next</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </section>

    <!-- Certificate Management Section -->
    <section class="content-section" id="certificates">
      <!-- Certificates Header -->
      <div class="certificate-header">
        <div class="header-content">
          <h1><i class="fas fa-award"></i> Calibration Certificates</h1>
          <p class="header-subtitle">Issued certificates from completed calibration worksheets</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-modern" onclick="openCertificateTemplateModal()">
            <i class="fas fa-palette"></i>
            <span>Templates</span>
          </button>
          <button class="btn btn-secondary btn-modern" onclick="openExportModal()">
            <i class="fas fa-download"></i>
            <span>Export Batch</span>
          </button>
          <button class="btn btn-primary btn-modern" onclick="window.location.hash='worksheets'">
            <i class="fas fa-file-lines"></i>
            <span>Go to Worksheets</span>
          </button>
        </div>
      </div>

      <!-- Certificate Statistics Overview -->
      <div class="quick-stats-bar" style="margin-bottom: 24px;">
        <div class="quick-stat-item">
          <i class="fas fa-certificate" style="color: var(--stat-blue);"></i>
          <div class="quick-stat-content">
            <span class="quick-stat-value" id="totalCertificates">0</span>
            <span class="quick-stat-label">Total Issued</span>
          </div>
        </div>
        <div class="quick-stat-divider"></div>
        <div class="quick-stat-item">
          <i class="fas fa-check-circle" style="color: var(--status-success);"></i>
          <div class="quick-stat-content">
            <span class="quick-stat-value" id="activeCertificates">0</span>
            <span class="quick-stat-label">Active</span>
          </div>
        </div>
        <div class="quick-stat-divider"></div>
        <div class="quick-stat-item warning">
          <i class="fas fa-clock" style="color: var(--status-warning);"></i>
          <div class="quick-stat-content">
            <span class="quick-stat-value" id="expiringSoonCertificates">0</span>
            <span class="quick-stat-label">Expiring Soon (30 days)</span>
          </div>
        </div>
        <div class="quick-stat-divider"></div>
        <div class="quick-stat-item">
          <i class="fas fa-times-circle" style="color: var(--status-danger);"></i>
          <div class="quick-stat-content">
            <span class="quick-stat-value" id="expiredCertificates">0</span>
            <span class="quick-stat-label">Expired</span>
          </div>
        </div>
      </div>

      <!-- Filters and Search Bar -->
      <div class="filters-bar" style="margin-bottom: 20px;">
        <div class="filter-group" style="display: flex; gap: 12px; flex: 1;">
          <input 
            type="search" 
            id="certificateSearch" 
            placeholder="ðŸ” Search by certificate number, customer, equipment..." 
            class="search-input"
            style="flex: 1; min-width: 300px;">
          
          <select id="certStatusFilter" class="filter-select">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="expiring-soon">Expiring Soon</option>
            <option value="expired">Expired</option>
          </select>
          
          <select id="certEquipmentTypeFilter" class="filter-select">
            <option value="">All Equipment Types</option>
            <option value="pressure">Pressure</option>
            <option value="temperature">Temperature</option>
            <option value="electrical">Electrical</option>
            <option value="mechanical">Mechanical</option>
            <option value="dimensional">Dimensional</option>
            <option value="custom">Other</option>
          </select>

          <input 
            type="date" 
            id="certDateFrom" 
            class="filter-select" 
            placeholder="From Date"
            title="Issue Date From">
          
          <input 
            type="date" 
            id="certDateTo" 
            class="filter-select" 
            placeholder="To Date"
            title="Issue Date To">
        </div>
        
        <div class="view-toggle">
          <button class="view-btn active" data-view="grid" onclick="toggleCertificateView('grid')">
            <i class="fas fa-grip"></i>
          </button>
          <button class="view-btn" data-view="list" onclick="toggleCertificateView('list')">
            <i class="fas fa-list"></i>
          </button>
        </div>
      </div>

      <!-- Certificates Grid View -->
      <div class="certificates-grid" id="certificatesGrid">
        <!-- Certificates will be loaded here dynamically -->
      </div>

      <!-- Certificates List View (Hidden by default) -->
      <div class="certificates-list" id="certificatesList" style="display: none;">
        <table class="data-table">
          <thead>
            <tr>
              <th style="width: 140px;">Certificate No.</th>
              <th>Equipment</th>
              <th>Customer</th>
              <th style="width: 110px;">Issue Date</th>
              <th style="width: 110px;">Due Date</th>
              <th style="width: 100px;">Status</th>
              <th style="width: 200px;">Actions</th>
            </tr>
          </thead>
          <tbody id="certificatesListBody">
            <!-- List view rows will be loaded here -->
          </tbody>
        </table>
      </div>
    </section>

    <section class="certificate-creation" style="display: none;">
      <h2>Create New Calibration Certificate</h2>
      <div class="form-grid">
        <label>Equipment Type
          <select id="instrumentType">
            <optgroup label="Flow Measurement Services">
              <option value="flow_meter_calibration">Flow Meter Calibration</option>
              <option value="prover_calibration">Prover Calibration</option>
            </optgroup>
            <optgroup label="Tank Calibrations">
              <option value="bulk_storage_tank">Bulk Storage Tank Calibration</option>
              <option value="road_tanker">Road Tanker Calibration</option>
            </optgroup>
            <optgroup label="Test Equipment - Electrical">
              <option value="digital_multimeter">Digital Multimeter</option>
              <option value="oscilloscope">Oscilloscope</option>
              <option value="power_meter">Power Meter</option>
              <option value="insulation_tester">Insulation Tester</option>
            </optgroup>
            <optgroup label="Test Equipment - Pressure">
              <option value="pressure_gauge">Pressure Gauge</option>
              <option value="pressure_transmitter">Pressure Transmitter</option>
              <option value="pressure_calibrator">Pressure Calibrator</option>
              <option value="differential_pressure">Differential Pressure Gauge</option>
            </optgroup>
            <optgroup label="Test Equipment - Temperature">
              <option value="temperature_sensor">Temperature Sensor</option>
              <option value="thermometer">Thermometer</option>
              <option value="thermocouple">Thermocouple</option>
              <option value="temperature_calibrator">Temperature Calibrator</option>
            </optgroup>
            <optgroup label="Test Equipment - Density">
              <option value="density_meter">Density Meter</option>
              <option value="hydrometer">Hydrometer</option>
              <option value="densitometer">Densitometer</option>
            </optgroup>
            <optgroup label="Test Equipment - Dimension">
              <option value="digital_caliper">Digital Caliper</option>
              <option value="micrometer">Micrometer</option>
              <option value="gauge_block">Gauge Block</option>
              <option value="dial_indicator">Dial Indicator</option>
            </optgroup>
            <optgroup label="Other Equipment">
              <option value="digital_scale">Digital Electronic Scale</option>
              <option value="analytical_balance">Analytical Balance</option>
              <option value="torque_wrench">Torque Wrench</option>
              <option value="force_gauge">Force Gauge</option>
              <option value="pipette">Pipette</option>
              <option value="ph_meter">pH Meter</option>
            </optgroup>
          </select>
        </label>
        <label>Service Location
          <select id="serviceLocation">
            <option value="onsite">Onsite Calibration</option>
            <option value="laboratory">Laboratory Based</option>
            <option value="both">Onsite & Laboratory</option>
          </select>
        </label>
        <label>Certificate Number 
          <input id="certNoCert" placeholder="M001-25" required>
          <small>Format: MXXX-YY (e.g., M018-20)</small>
        </label>
        <label>Issue Date 
          <input type="date" id="dateIssueCert" required>
        </label>
        <label>Due Date 
          <input type="date" id="dateDueCert">
        </label>
        <label>Customer 
          <input id="customerCert" placeholder="TechnipFMC Ghana">
        </label>
        <label>Address
          <textarea id="customerAddressCert" rows="2" placeholder="Takoradi Commercial Port&#10;Takoradi"></textarea>
        </label>
        <label>Job Reference 
          <input id="jobRefCert" placeholder="CMS4-004/1">
        </label>
        <label>Site Name
          <input id="siteNameCert" placeholder="IGL Lab">
        </label>
      </div>
      <div class="action-row">
        <button id="newRecord" class="btn-primary" onclick="window.showNewRecordForm && window.showNewRecordForm()">Create New Record</button>
        <button id="loadTemplate" class="btn-secondary" onclick="window.showTemplateDialog && window.showTemplateDialog()">Load Template</button>
      </div>
    </section>

    <div id="formArea" class="calibration-form" style="display:none">
      <div class="form-progress">
        <div class="progress-step active" data-step="1">Equipment Details</div>
        <div class="progress-step" data-step="2">Test Results</div>
        <div class="progress-step" data-step="3">Review & Sign</div>
      </div>

      <div class="form-step active" data-step="1">
        <h2>ðŸ“‹ Equipment Details & Specifications</h2>
        <div class="equipment-grid">
          <label>Equipment Description
            <input id="equipDescCert" placeholder="Digital Electronic Scale" required>
          </label>
          <label>Manufacturer
            <input id="manufacturerCert" placeholder="Prochef" required>
          </label>
          <label>Type / Range
            <input id="typeRangeCert" placeholder="Nil" required>
          </label>
          <label>Serial Number
            <input id="serialNumberCert" placeholder="6596446" required>
          </label>
          <label>Full Scale (FS)
            <input id="fullScale" type="number" value="100" step="0.001" required>
            <small>Maximum measurement range</small>
          </label>
          <label>Accuracy (% of FS)
            <input id="accuracy" type="number" step="0.001" value="2.0" required>
            <small>Manufacturer specified accuracy</small>
          </label>
          <label>Units
            <select id="units">
              <option value="PSI">PSI</option>
              <option value="Bar">Bar</option>
              <option value="kPa">kPa</option>
              <option value="mbar">mbar</option>
              <option value="Nâ‹…m">Nâ‹…m (Torque)</option>
              <option value="V">Volts</option>
              <option value="A">Amperes</option>
              <option value="Â°C">Â°C</option>
              <option value="Â°F">Â°F</option>
            </select>
          </label>
          <label>Environmental Conditions
            <input id="envConditions" placeholder="Temp: 20Â±2Â°C, RH: 50Â±10%">
          </label>
        </div>
        
        <div class="certificate-sections">
          <h3>ðŸŒ¡ï¸ Environment Conditions</h3>
          <div class="trace-grid">
            <label>Temperature Range
              <input id="tempRange" placeholder="22.2 to 22.3Â°C">
            </label>
            <label>Humidity Range
              <input id="humidityRange" placeholder="19.8 to 50.0%">
            </label>
          </div>
        </div>
        
        <div class="traceability-section">
          <h3>ðŸ“Š Traceability Information</h3>
          <div class="trace-grid">
            <label>Reference Standard
              <input id="refStandard" placeholder="Henry Troemner LLC Standard Test weight, S/No.: TW-009, TW-010, TW-011, TW-012">
            </label>
            <label>Certificate Number
              <input id="refCertNo" placeholder="NIE/QAL/CAC/2019-2022/T194">
            </label>
            <label>Calibration Date
              <input type="date" id="refCalDate">
            </label>
            <label>Recalibration Due
              <input type="date" id="refDueDate">
            </label>
          </div>
        </div>
        
        <div class="step-actions">
          <button class="btn-primary" onclick="nextStep()">Next: Test Results â†’</button>
        </div>
      </div>

      <div class="form-step" data-step="2">
        <h2>ðŸ”¬ Calibration Test Results</h2>
        <div class="test-controls">
          <button id="addRow" class="btn-secondary" onclick="window.addBasicTestRow && window.addBasicTestRow()">+ Add Test Point</button>
          <button id="addSetTemplate" class="btn-secondary">Add Standard Set</button>
          <button id="calculateUncertainty" class="btn-secondary">Calculate Uncertainty</button>
        </div>
        
        <div class="table-container">
          <table id="resultsTable" class="results-table">
            <thead>
              <tr>
                <th>Reference Value</th>
                <th>Direction</th>
                <th>Measured Value</th>
                <th>Deviation</th>
                <th>% Error</th>
                <th>Pass/Fail</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        
        <div class="results-summary">
          <h3>ðŸ“ˆ Test Summary</h3>
          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-label">Total Points:</span>
              <span id="totalPoints" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Passed:</span>
              <span id="passedPoints" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Failed:</span>
              <span id="failedPoints" class="stat-value">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Overall Result:</span>
              <span id="overallResult" class="stat-value">-</span>
            </div>
          </div>
        </div>
        
        <div class="attachments-section">
          <h3>ðŸ“Ž Attachments</h3>
          <input type="file" id="fileAttach" multiple accept="image/*,.pdf,.doc,.xlsx">
          <div id="attachmentsList" class="attachments-list"></div>
        </div>
        
        <div class="step-actions">
          <button class="btn-secondary" onclick="prevStep()">â† Previous</button>
          <button class="btn-primary" onclick="nextStep()">Next: Review & Sign â†’</button>
        </div>
      </div>

      <div class="form-step" data-step="3">
        <h2>âœï¸ Review & Digital Signature</h2>
        
        <div class="review-section">
          <h3>Certificate Preview</h3>
          <div id="certificatePreview" class="certificate-preview">
            <!-- Dynamic preview content -->
          </div>
        </div>
        
        <div class="signature-section">
          <h3>âœï¸ Approved Signatories</h3>
          <div class="signature-controls">
            <label>Calibrated by
              <input id="techName" placeholder="John Doe">
            </label>
            <label>Approved Signatories
              <input id="approvedSigs" placeholder="John Doe [ ] Jane Smith [ ] Robert Johnson [ ]">
            </label>
          </div>
          
          <div class="comments-section">
            <label>Comments
              <textarea id="comments" rows="4" placeholder="The unit under test(uut) was calibrated according to OIML and by comparison with a standard weight of equal norminal value. The conventional mass has been calculated from the weighing differences under consideration of the air density during the calibration and the assumed density. The unit under test was left for a day before calibration."></textarea>
            </label>
          </div>
          
          <div class="signature-canvas-container">
            <canvas id="sigCanvas" width="400" height="150"></canvas>
            <div class="signature-actions">
              <button id="clearSig" class="btn-secondary">Clear Signature</button>
              <button id="saveSignature" class="btn-secondary">Save Signature</button>
            </div>
          </div>
        </div>
        
        <div class="final-actions">
          <button class="btn-secondary" onclick="prevStep()">â† Previous</button>
          <button id="saveLocal" class="btn-success" onclick="window.saveBasicCertificate && window.saveBasicCertificate()">ðŸ’¾ Save Certificate</button>
          <button id="generatePdf" class="btn-primary" onclick="window.generateBasicPdf && window.generateBasicPdf()">ðŸ“„ Generate PDF</button>
          <button id="downloadPdf" class="btn-primary" onclick="window.downloadPdfDirect && window.downloadPdfDirect()" style="background: #27ae60;">â¬‡ï¸ Download PDF</button>
        </div>
      </div>
    </div>

    <!-- OLD Certificate Management section removed - functionality now in main certificates page -->

    <!-- Certificate Preview Modal -->
    <div id="certificatePreviewModal" class="modal" style="display:none">
      <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
        <div class="modal-header">
          <h2><i class="fas fa-file-certificate"></i> Certificate Preview</h2>
          <button class="modal-close" onclick="closeCertificatePreview()">&times;</button>
        </div>
        
        <div style="padding: 20px; overflow-y: auto; max-height: calc(90vh - 200px);">
          <div id="certificatePreviewContent" style="background: white; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-height: 400px;">
            <!-- Certificate content will be rendered here -->
          </div>
        </div>

        <div class="modal-footer-actions" style="border-top: 1px solid #eee; padding: 16px 20px;">
          <button class="btn-secondary" onclick="closeCertificatePreview()">
            <i class="fas fa-times"></i> Close
          </button>
          <button class="btn-secondary" onclick="editCertificateWorksheet()">
            <i class="fas fa-edit"></i> Edit Worksheet
          </button>
          <button class="btn-secondary" onclick="openCertificateTemplateModal()">
            <i class="fas fa-palette"></i> Change Template
          </button>
          <button class="btn-primary" onclick="downloadCertificatePDF()">
            <i class="fas fa-file-pdf"></i> Download PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Certificate Template Selection Modal -->
    <div id="certificateTemplateModal" class="modal" style="display:none">
      <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
          <h2><i class="fas fa-palette"></i> Certificate Templates</h2>
          <button class="modal-close" onclick="closeCertificateTemplateModal()">&times;</button>
        </div>
        <p class="modal-subtitle">Select a template design for your calibration certificates</p>
        
        <div style="padding: 20px;">
          <div class="template-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
            
            <!-- Template 1: Classic Professional -->
            <div class="template-card" onclick="selectCertificateTemplate('classic')">
              <div class="template-preview" style="background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); padding: 20px; border-radius: 8px; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 3px solid transparent; cursor: pointer; transition: all 0.3s;">
                <div style="text-align: center;">
                  <i class="fas fa-certificate" style="font-size: 48px; color: #1976d2; margin-bottom: 12px;"></i>
                  <div style="background: white; padding: 8px 16px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="font-weight: 600; font-size: 12px; color: #333;">CALIBRATION CERTIFICATE</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">Classic Layout</div>
                  </div>
                </div>
              </div>
              <div style="padding: 12px; text-align: center;">
                <h4 style="margin: 0 0 4px 0; font-size: 14px;">Classic Professional</h4>
                <p style="margin: 0; font-size: 12px; color: #666;">Traditional formal design with company header</p>
              </div>
            </div>

            <!-- Template 2: Modern Minimal -->
            <div class="template-card" onclick="selectCertificateTemplate('modern')">
              <div class="template-preview" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); padding: 20px; border-radius: 8px; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 3px solid transparent; cursor: pointer; transition: all 0.3s;">
                <div style="text-align: center;">
                  <i class="fas fa-award" style="font-size: 48px; color: #7b1fa2; margin-bottom: 12px;"></i>
                  <div style="background: white; padding: 8px 16px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); border-left: 4px solid #7b1fa2;">
                    <div style="font-weight: 600; font-size: 12px; color: #333;">Calibration Certificate</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">Clean Modern Design</div>
                  </div>
                </div>
              </div>
              <div style="padding: 12px; text-align: center;">
                <h4 style="margin: 0 0 4px 0; font-size: 14px;">Modern Minimal</h4>
                <p style="margin: 0; font-size: 12px; color: #666;">Clean contemporary design with accent colors</p>
              </div>
            </div>

            <!-- Template 3: Detailed Technical -->
            <div class="template-card" onclick="selectCertificateTemplate('technical')">
              <div class="template-preview" style="background: linear-gradient(135deg, #e8f4f8 0%, #d0e8f0 100%); padding: 20px; border-radius: 8px; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 3px solid transparent; cursor: pointer; transition: all 0.3s;">
                <div style="text-align: center;">
                  <i class="fas fa-clipboard-check" style="font-size: 48px; color: #00796b; margin-bottom: 12px;"></i>
                  <div style="background: white; padding: 8px 16px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-top: 3px solid #00796b;">
                    <div style="font-weight: 600; font-size: 11px; color: #333; font-family: monospace;">â•â•â• CALIBRATION â•â•â•</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px;">Technical Report Format</div>
                  </div>
                </div>
              </div>
              <div style="padding: 12px; text-align: center;">
                <h4 style="margin: 0 0 4px 0; font-size: 14px;">Detailed Technical</h4>
                <p style="margin: 0; font-size: 12px; color: #666;">Comprehensive layout with detailed data tables</p>
              </div>
            </div>

            <!-- Template 4: Elegant Premium -->
            <div class="template-card" onclick="selectCertificateTemplate('premium')">
              <div class="template-preview" style="background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); padding: 20px; border-radius: 8px; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 3px solid transparent; cursor: pointer; transition: all 0.3s;">
                <div style="text-align: center;">
                  <i class="fas fa-medal" style="font-size: 48px; color: #f57c00; margin-bottom: 12px;"></i>
                  <div style="background: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 2px solid #f57c00;">
                    <div style="font-weight: 700; font-size: 13px; color: #f57c00; letter-spacing: 1px;">CERTIFICATE</div>
                    <div style="font-size: 10px; color: #666; margin-top: 4px; font-style: italic;">of Calibration</div>
                  </div>
                </div>
              </div>
              <div style="padding: 12px; text-align: center;">
                <h4 style="margin: 0 0 4px 0; font-size: 14px;">Elegant Premium</h4>
                <p style="margin: 0; font-size: 12px; color: #666;">Sophisticated design with decorative elements</p>
              </div>
            </div>

          </div>

          <div style="margin-top: 24px; padding: 16px; background: #f5f5f5; border-radius: 8px;">
            <h4 style="margin: 0 0 8px 0; font-size: 13px; color: #333;">
              <i class="fas fa-info-circle"></i> Template Features
            </h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: #666;">
              <li>All templates include company logo and branding</li>
              <li>Fully customizable headers, footers, and color schemes</li>
              <li>Optimized for A4 and Letter paper sizes</li>
              <li>Professional PDF output with proper formatting</li>
              <li>Template selection is saved per certificate</li>
            </ul>
          </div>
        </div>

        <div class="modal-footer-actions">
          <button class="btn-secondary" onclick="closeCertificateTemplateModal()">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Equipment Management Section -->
    <section class="content-section" id="equipment">
      <div class="section-header">
        <h2><i class="fas fa-tools"></i> Master Equipment List</h2>
        <div class="section-actions">
          <a href="equipment.html" class="btn-primary">
            <i class="fas fa-external-link-alt"></i> Open Equipment Manager
          </a>
        </div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #FFB800 0%, #FFA000 100%);">
            <i class="fas fa-tools"></i>
          </div>
          <h3>Master Equipment Database</h3>
          <p>Comprehensive equipment management system with calibration tracking, traceability records, and status monitoring.</p>
          <div style="margin-top: 16px;">
            <a href="equipment.html" class="btn-primary" style="width: 100%; text-align: center;">
              <i class="fas fa-tools"></i> Manage Equipment
            </a>
          </div>
        </div>
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>Valid Calibrations</h3>
          <p>View all equipment with current and valid calibration certificates.</p>
          <div style="margin-top: 16px;">
            <a href="equipment.html?status=valid" class="btn-secondary" style="width: 100%; text-align: center;">
              <i class="fas fa-list"></i> View Valid
            </a>
          </div>
        </div>
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h3>Due Soon & Overdue</h3>
          <p>Monitor equipment requiring calibration attention to maintain compliance.</p>
          <div style="margin-top: 16px;">
            <a href="equipment.html?status=overdue" class="btn-secondary" style="width: 100%; text-align: center;">
              <i class="fas fa-clock"></i> View Alerts
            </a>
          </div>
        </div>
      </div>
      <div style="margin-top: 24px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #FFB800;">
        <h4 style="margin-bottom: 12px; color: #333;"><i class="fas fa-info-circle"></i> Equipment Features</h4>
        <ul style="list-style: none; padding: 0; color: #666;">
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Complete equipment database with detailed specifications</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Calibration status tracking and alerts</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Traceability records and certificate management</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Advanced filtering and search capabilities</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Equipment maintenance history</li>
        </ul>
      </div>
    </section>

    <!-- Clients Section -->
    <section class="content-section" id="clients">
      <div class="section-header">
        <h2><i class="fas fa-users"></i> Client Management</h2>
        <div class="section-actions">
          <a href="clients.html" class="btn-primary">
            <i class="fas fa-external-link-alt"></i> Open Client Manager
          </a>
        </div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
            <i class="fas fa-users"></i>
          </div>
          <h3>Client Database</h3>
          <p>Comprehensive client management with contact information, service history, and billing details.</p>
          <div style="margin-top: 16px;">
            <a href="clients.html" class="btn-primary" style="width: 100%; text-align: center;">
              <i class="fas fa-users"></i> Manage Clients
            </a>
          </div>
        </div>
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);">
            <i class="fas fa-handshake"></i>
          </div>
          <h3>Active Clients</h3>
          <p>View all clients with active calibration service agreements.</p>
          <div style="margin-top: 16px;">
            <a href="clients.html?status=active" class="btn-secondary" style="width: 100%; text-align: center;">
              <i class="fas fa-list"></i> View Active
            </a>
          </div>
        </div>
        <div class="card">
          <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">
            <i class="fas fa-file-invoice-dollar"></i>
          </div>
          <h3>Service Reports</h3>
          <p>Generate client service reports and calibration history summaries.</p>
          <div style="margin-top: 16px;">
            <a href="clients.html?view=reports" class="btn-secondary" style="width: 100%; text-align: center;">
              <i class="fas fa-chart-line"></i> View Reports
            </a>
          </div>
        </div>
      </div>
      <div style="margin-top: 24px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #6366f1;">
        <h4 style="margin-bottom: 12px; color: #333;"><i class="fas fa-info-circle"></i> Client Management Features</h4>
        <ul style="list-style: none; padding: 0; color: #666;">
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Complete client contact database</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Service history and calibration records</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Billing and payment tracking</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Automated service reminders</li>
          <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #28a745; margin-right: 8px;"></i> Document management and sharing</li>
        </ul>
      </div>
    </section>

    <!-- Reports Section -->
    <section class="content-section" id="reports">
      <div class="section-header">
        <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
        <div class="section-actions">
          <button class="btn-primary" onclick="showNotification('Reports module coming soon!', 'info')">
            <i class="fas fa-file-alt"></i> Generate Report
          </button>
        </div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <h3>Performance Reports</h3>
          <p>Generate comprehensive calibration performance reports.</p>
          <button class="btn-secondary" onclick="showNotification('Performance reports coming soon!', 'info')">
            <i class="fas fa-chart-line"></i> View Reports
          </button>
        </div>
      </div>
    </section>

    <!-- Advanced Settings Section -->
    <section class="content-section" id="settings">
      <div class="section-header">
        <h2><i class="fas fa-cog"></i> Advanced Settings</h2>
        <div style="display: flex; gap: 10px;">
          <button class="btn-secondary" onclick="resetSettings()">
            <i class="fas fa-undo"></i> Reset to Defaults
          </button>
          <button class="btn-primary" onclick="saveAllSettings()">
            <i class="fas fa-save"></i> Save All Changes
          </button>
        </div>
      </div>

      <!-- Settings Navigation Tabs -->
      <div class="settings-tabs">
        <button class="settings-tab active" onclick="switchSettingsTab('general')" data-tab="general">
          <i class="fas fa-sliders-h"></i>
          <span>General</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('company')" data-tab="company">
          <i class="fas fa-building"></i>
          <span>Company</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('certificates')" data-tab="certificates">
          <i class="fas fa-certificate"></i>
          <span>Certificates</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('notifications')" data-tab="notifications">
          <i class="fas fa-bell"></i>
          <span>Notifications</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('integrations')" data-tab="integrations">
          <i class="fas fa-plug"></i>
          <span>Integrations</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('security')" data-tab="security">
          <i class="fas fa-shield-alt"></i>
          <span>Security</span>
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('advanced')" data-tab="advanced">
          <i class="fas fa-cogs"></i>
          <span>Advanced</span>
        </button>
      </div>

      <!-- Settings Content Panels -->
      <div class="settings-content">
        
        <!-- General Settings -->
        <div class="settings-panel active" id="settings-general">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-globe"></i> Regional Settings</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Language</label>
                  <select class="settings-select" id="setting-language">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Timezone</label>
                  <select class="settings-select" id="setting-timezone">
                    <option value="UTC">UTC</option>
                    <option value="GMT">GMT</option>
                    <option value="EST">Eastern Time (EST)</option>
                    <option value="PST">Pacific Time (PST)</option>
                    <option value="CST">Central Time (CST)</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Date Format</label>
                  <select class="settings-select" id="setting-date-format">
                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Time Format</label>
                  <select class="settings-select" id="setting-time-format">
                    <option value="12">12 Hour</option>
                    <option value="24">24 Hour</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-database"></i> Data Management</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Auto-save</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-autosave" class="toggle-checkbox" checked>
                    <label for="setting-autosave" class="toggle-label">Enable auto-save</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Backup Frequency</label>
                  <select class="settings-select" id="setting-backup-frequency">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Data Retention (days)</label>
                  <input type="number" class="settings-input" id="setting-data-retention" value="365" min="30">
                </div>
                <div class="settings-field">
                  <button class="btn-danger" onclick="exportAllData()">
                    <i class="fas fa-download"></i> Export All Data
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Company Settings -->
        <div class="settings-panel" id="settings-company">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-building"></i> Company Information</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Company Name</label>
                  <input type="text" class="settings-input" id="setting-company-name" value="CalPro Calibration Services">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Lab Code / ID</label>
                  <input type="text" class="settings-input" id="setting-lab-code" value="CP-LAB-001">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Address</label>
                  <textarea class="settings-textarea" id="setting-company-address" rows="3"></textarea>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Phone</label>
                  <input type="tel" class="settings-input" id="setting-company-phone">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Email</label>
                  <input type="email" class="settings-input" id="setting-company-email" value="info@calpro.com">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Website</label>
                  <input type="url" class="settings-input" id="setting-company-website">
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-award"></i> Accreditation</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Accreditation Body</label>
                  <input type="text" class="settings-input" id="setting-accreditation-body" placeholder="e.g., ISO/IEC 17025">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Certificate Number</label>
                  <input type="text" class="settings-input" id="setting-accreditation-number">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Valid Until</label>
                  <input type="date" class="settings-input" id="setting-accreditation-expiry">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Logo Upload</label>
                  <input type="file" class="settings-file" id="setting-company-logo" accept="image/*">
                  <small class="settings-hint">Recommended: 300x100px, PNG or JPG</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Certificate Settings -->
        <div class="settings-panel" id="settings-certificates">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-file-alt"></i> Certificate Templates</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Default Template</label>
                  <select class="settings-select" id="setting-default-template">
                    <option value="standard">Standard</option>
                    <option value="detailed">Detailed</option>
                    <option value="minimal">Minimal</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Certificate Prefix</label>
                  <input type="text" class="settings-input" id="setting-cert-prefix" value="CP-CERT-">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Starting Number</label>
                  <input type="number" class="settings-input" id="setting-cert-start-number" value="1000">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Include QR Code</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-include-qr" class="toggle-checkbox" checked>
                    <label for="setting-include-qr" class="toggle-label">Add QR code to certificates</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Digital Signature</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-digital-signature" class="toggle-checkbox">
                    <label for="setting-digital-signature" class="toggle-label">Enable digital signatures</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-calculator"></i> Measurement Settings</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Default Unit System</label>
                  <select class="settings-select" id="setting-unit-system">
                    <option value="metric">Metric (SI)</option>
                    <option value="imperial">Imperial</option>
                    <option value="both">Both</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Decimal Places</label>
                  <input type="number" class="settings-input" id="setting-decimal-places" value="2" min="0" max="10">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Uncertainty Format</label>
                  <select class="settings-select" id="setting-uncertainty-format">
                    <option value="absolute">Absolute (Â±)</option>
                    <option value="percentage">Percentage (%)</option>
                    <option value="both">Both</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Confidence Level</label>
                  <select class="settings-select" id="setting-confidence-level">
                    <option value="95">95%</option>
                    <option value="99">99%</option>
                    <option value="99.7">99.7%</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notifications Settings -->
        <div class="settings-panel" id="settings-notifications">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-envelope"></i> Email Notifications</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Calibration Due Reminders</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-notify-due" class="toggle-checkbox" checked>
                    <label for="setting-notify-due" class="toggle-label">Send reminders</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Reminder Days Before Due</label>
                  <input type="number" class="settings-input" id="setting-reminder-days" value="30" min="1">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Certificate Created</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-notify-cert-created" class="toggle-checkbox" checked>
                    <label for="setting-notify-cert-created" class="toggle-label">Notify when certificate is created</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">System Alerts</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-notify-system" class="toggle-checkbox" checked>
                    <label for="setting-notify-system" class="toggle-label">Receive system alerts</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-desktop"></i> In-App Notifications</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Show Notifications</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-show-notifications" class="toggle-checkbox" checked>
                    <label for="setting-show-notifications" class="toggle-label">Enable in-app notifications</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Notification Sound</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-notification-sound" class="toggle-checkbox">
                    <label for="setting-notification-sound" class="toggle-label">Play sound</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Auto-dismiss After (seconds)</label>
                  <input type="number" class="settings-input" id="setting-notification-timeout" value="5" min="1">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Integrations Settings -->
        <div class="settings-panel" id="settings-integrations">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-envelope-open-text"></i> Email Configuration</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">SMTP Server</label>
                  <input type="text" class="settings-input" id="setting-smtp-server" placeholder="smtp.gmail.com">
                </div>
                <div class="settings-field">
                  <label class="settings-label">SMTP Port</label>
                  <input type="number" class="settings-input" id="setting-smtp-port" value="587">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Email Username</label>
                  <input type="email" class="settings-input" id="setting-smtp-username">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Email Password</label>
                  <input type="password" class="settings-input" id="setting-smtp-password">
                </div>
                <div class="settings-field">
                  <button class="btn-secondary" onclick="testEmailConnection()">
                    <i class="fas fa-paper-plane"></i> Test Connection
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-cloud"></i> Cloud Storage</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Provider</label>
                  <select class="settings-select" id="setting-cloud-provider">
                    <option value="none">None</option>
                    <option value="dropbox">Dropbox</option>
                    <option value="google-drive">Google Drive</option>
                    <option value="onedrive">OneDrive</option>
                  </select>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Auto-sync</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-cloud-autosync" class="toggle-checkbox">
                    <label for="setting-cloud-autosync" class="toggle-label">Automatically sync data</label>
                  </div>
                </div>
                <div class="settings-field">
                  <button class="btn-secondary" onclick="connectCloudStorage()">
                    <i class="fas fa-link"></i> Connect Account
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-link"></i> API Access</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">API Key</label>
                  <div style="display: flex; gap: 10px;">
                    <input type="text" class="settings-input" id="setting-api-key" readonly value="sk-xxxxxxxxxxxxxxxx">
                    <button class="btn-secondary" onclick="regenerateAPIKey()">
                      <i class="fas fa-sync"></i> Regenerate
                    </button>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Enable API</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-enable-api" class="toggle-checkbox">
                    <label for="setting-enable-api" class="toggle-label">Allow external API access</label>
                  </div>
                </div>
                <div class="settings-field">
                  <button class="btn-secondary" onclick="viewAPIDocumentation()">
                    <i class="fas fa-book"></i> View Documentation
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="settings-panel" id="settings-security">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-lock"></i> Authentication</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Two-Factor Authentication</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-2fa" class="toggle-checkbox">
                    <label for="setting-2fa" class="toggle-label">Enable 2FA</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Session Timeout (minutes)</label>
                  <input type="number" class="settings-input" id="setting-session-timeout" value="60" min="5">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Password Expiration (days)</label>
                  <input type="number" class="settings-input" id="setting-password-expiry" value="90" min="0">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Minimum Password Length</label>
                  <input type="number" class="settings-input" id="setting-min-password" value="8" min="6">
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-user-shield"></i> Access Control</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Login Attempts Before Lockout</label>
                  <input type="number" class="settings-input" id="setting-login-attempts" value="5" min="3">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Lockout Duration (minutes)</label>
                  <input type="number" class="settings-input" id="setting-lockout-duration" value="30" min="5">
                </div>
                <div class="settings-field">
                  <label class="settings-label">IP Whitelisting</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-ip-whitelist" class="toggle-checkbox">
                    <label for="setting-ip-whitelist" class="toggle-label">Enable IP restrictions</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Audit Logging</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-audit-log" class="toggle-checkbox" checked>
                    <label for="setting-audit-log" class="toggle-label">Log all user actions</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-shield-virus"></i> Data Protection</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Encrypt Backups</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-encrypt-backups" class="toggle-checkbox" checked>
                    <label for="setting-encrypt-backups" class="toggle-label">Encrypt all backups</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Data Anonymization</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-anonymize" class="toggle-checkbox">
                    <label for="setting-anonymize" class="toggle-label">Anonymize exported data</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">GDPR Compliance</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-gdpr" class="toggle-checkbox" checked>
                    <label for="setting-gdpr" class="toggle-label">Enable GDPR features</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Advanced Settings -->
        <div class="settings-panel" id="settings-advanced">
          <div class="settings-grid">
            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-server"></i> System</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Debug Mode</label>
                  <div class="settings-toggle">
                    <input type="checkbox" id="setting-debug-mode" class="toggle-checkbox">
                    <label for="setting-debug-mode" class="toggle-label">Enable debug logging</label>
                  </div>
                </div>
                <div class="settings-field">
                  <label class="settings-label">Cache Duration (hours)</label>
                  <input type="number" class="settings-input" id="setting-cache-duration" value="24" min="1">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Max Upload Size (MB)</label>
                  <input type="number" class="settings-input" id="setting-max-upload" value="10" min="1">
                </div>
                <div class="settings-field">
                  <button class="btn-secondary" onclick="clearCache()">
                    <i class="fas fa-trash"></i> Clear Cache
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-database"></i> Database</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <label class="settings-label">Database Size</label>
                  <input type="text" class="settings-input" id="database-size" readonly value="Calculating...">
                </div>
                <div class="settings-field">
                  <label class="settings-label">Last Backup</label>
                  <input type="text" class="settings-input" id="last-backup" readonly value="Never">
                </div>
                <div class="settings-field">
                  <button class="btn-secondary" onclick="backupDatabase()">
                    <i class="fas fa-download"></i> Backup Now
                  </button>
                </div>
                <div class="settings-field">
                  <button class="btn-danger" onclick="optimizeDatabase()">
                    <i class="fas fa-sync"></i> Optimize Database
                  </button>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <div class="settings-card-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
              </div>
              <div class="settings-card-body">
                <div class="settings-field">
                  <button class="btn-danger" onclick="confirmResetDatabase()">
                    <i class="fas fa-database"></i> Reset All Data
                  </button>
                  <small class="settings-hint" style="color: #dc3545;">This action cannot be undone!</small>
                </div>
                <div class="settings-field">
                  <button class="btn-danger" onclick="confirmFactoryReset()">
                    <i class="fas fa-redo"></i> Factory Reset
                  </button>
                  <small class="settings-hint" style="color: #dc3545;">Resets all settings and data!</small>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- Admin User Management Section -->
    <section class="content-section" id="admin" style="display: none;">
      <div class="section-header">
        <h2><i class="fas fa-users-cog"></i> User Management</h2>
        <button class="btn-primary" onclick="showAddUserModal()">
          <i class="fas fa-user-plus"></i> Add User
        </button>
      </div>

      <!-- Search and Filter Bar -->
      <div class="card" style="margin-bottom: 20px;">
        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
          <div style="flex: 1; min-width: 250px;">
            <div style="position: relative;">
              <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999;"></i>
              <input type="text" id="userSearchInput" placeholder="Search by name or email..." 
                     style="width: 100%; padding: 10px 10px 10px 40px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
                     oninput="searchUsers()">
            </div>
          </div>
          <div style="min-width: 150px;">
            <select id="roleFilter" class="form-control" onchange="filterUsers()" style="padding: 10px;">
              <option value="">All Roles</option>
              <option value="admin">Admin</option>
              <option value="lead_calibrator">Lead Calibrator</option>
              <option value="calibrator">Calibrator</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>
          <div style="min-width: 150px;">
            <select id="statusFilter" class="form-control" onchange="filterUsers()" style="padding: 10px;">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <button class="btn-secondary" onclick="refreshUsers()">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
        </div>
      </div>

      <!-- Users Table -->
      <div class="card">
        <div id="usersTableContainer">
          <table class="data-table" id="usersTable">
            <thead>
              <tr>
                <th style="width: 60px;">Avatar</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th style="width: 150px;">Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <tr>
                <td colspan="7" style="text-align: center; padding: 40px;">
                  <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #FFB800;"></i>
                  <p style="margin-top: 10px; color: #999;">Loading users...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div id="usersPagination" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
          <div style="color: #666; font-size: 14px;" id="usersCountInfo">
            Showing 0 of 0 users
          </div>
          <div style="display: flex; gap: 5px;" id="paginationButtons">
            <!-- Pagination buttons will be generated here -->
          </div>
        </div>
      </div>

      <!-- Empty State (hidden by default) -->
      <div class="card" id="usersEmptyState" style="display: none; text-align: center; padding: 60px 20px;">
        <i class="fas fa-users" style="font-size: 48px; color: #ddd; margin-bottom: 20px;"></i>
        <h3 style="color: #666; margin-bottom: 10px;">No Users Found</h3>
        <p style="color: #999;">Try adjusting your search or filters</p>
      </div>
    </section>

    <!-- Profile section moved to profile.html -->

  </main>

  <!-- Equipment Template Selection Modal (Dynamic) -->
  <!-- Notification Lightbox -->
  <div id="notificationLightbox">
    <div class="notification-box">
      <div class="notification-icon" id="notificationIcon"></div>
      <h3 id="notificationTitle"></h3>
      <p id="notificationMessage"></p>
      <div class="notification-actions" id="notificationActions"></div>
    </div>
  </div>

  <!-- Quick Scan Modal -->
  <div id="quickScanModal" class="modal" style="display:none">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2><i class="fas fa-qrcode"></i> Quick Scan</h2>
        <button class="modal-close" onclick="closeQuickScanModal()">&times;</button>
      </div>
      <p class="modal-subtitle">Scan or enter equipment tag/serial number to quickly find records</p>
      
      <div style="padding: 20px;">
        <div class="form-group">
          <label for="scanInput">
            <i class="fas fa-barcode"></i> Equipment Tag/Serial Number
          </label>
          <input 
            type="text" 
            id="scanInput" 
            class="form-control" 
            placeholder="Enter or scan equipment ID..." 
            autofocus
            style="font-size: 16px; padding: 12px;">
          <small style="color: #666; margin-top: 8px; display: block;">
            <i class="fas fa-info-circle"></i> Enter tag number or scan barcode/QR code
          </small>
        </div>

        <div id="scanResults" style="margin-top: 20px; display: none;">
          <h3 style="font-size: 14px; color: #666; margin-bottom: 12px;">Search Results:</h3>
          <div id="scanResultsList"></div>
        </div>
      </div>

      <div class="modal-footer-actions">
        <button class="btn-secondary" onclick="closeQuickScanModal()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn-primary" onclick="performQuickScan()">
          <i class="fas fa-search"></i> Search
        </button>
      </div>
    </div>
  </div>

  <!-- Export Data Modal -->
  <div id="exportModal" class="modal" style="display:none">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2><i class="fas fa-download"></i> Export Worksheets & Certificates</h2>
        <button class="modal-close" onclick="closeExportModal()">&times;</button>
      </div>
      <p class="modal-subtitle">Define parameters for batch export and certificate generation</p>
      
      <div style="padding: 20px;">
        <!-- Date Range -->
        <div class="form-group">
          <label><i class="fas fa-calendar-alt"></i> Date Range</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <label for="exportStartDate" style="font-size: 12px; color: #666;">Start Date</label>
              <input type="date" id="exportStartDate" class="form-control">
            </div>
            <div>
              <label for="exportEndDate" style="font-size: 12px; color: #666;">End Date</label>
              <input type="date" id="exportEndDate" class="form-control">
            </div>
          </div>
        </div>

        <!-- Status Filter -->
        <div class="form-group">
          <label for="exportStatus"><i class="fas fa-filter"></i> Worksheet Status</label>
          <select id="exportStatus" class="form-control">
            <option value="all">All Worksheets</option>
            <option value="completed" selected>Completed Only</option>
            <option value="pending">Pending/Draft</option>
          </select>
        </div>

        <!-- Equipment Type Filter -->
        <div class="form-group">
          <label for="exportEquipmentType"><i class="fas fa-tools"></i> Equipment Type</label>
          <select id="exportEquipmentType" class="form-control">
            <option value="all">All Equipment Types</option>
            <option value="pressure">Pressure Equipment</option>
            <option value="temperature">Temperature Equipment</option>
            <option value="dimensional">Dimensional Equipment</option>
            <option value="electrical">Electrical Equipment</option>
            <option value="torque">Torque Equipment</option>
            <option value="other">Other Equipment</option>
          </select>
        </div>

        <!-- Job/Site Filter -->
        <div class="form-group">
          <label for="exportJobSite"><i class="fas fa-building"></i> Job/Site (Optional)</label>
          <input 
            type="text" 
            id="exportJobSite" 
            class="form-control" 
            placeholder="Enter job number or site name...">
          <small style="color: #666; margin-top: 4px; display: block;">
            Leave blank to include all jobs/sites
          </small>
        </div>

        <!-- Export Format -->
        <div class="form-group">
          <label for="exportFormat"><i class="fas fa-file-export"></i> Export Format</label>
          <select id="exportFormat" class="form-control">
            <option value="pdf-bundle">PDF Certificate Bundle (one file)</option>
            <option value="pdf-separate">PDF Certificates (separate files)</option>
            <option value="excel">Excel Spreadsheet (.xlsx)</option>
            <option value="csv">CSV Data Export</option>
          </select>
        </div>

        <!-- Summary -->
        <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; margin-top: 16px;">
          <h4 style="font-size: 13px; margin: 0 0 8px 0; color: #333;">
            <i class="fas fa-info-circle"></i> Export Summary
          </h4>
          <p id="exportSummary" style="font-size: 12px; margin: 0; color: #666;">
            Select parameters to see export summary
          </p>
        </div>
      </div>

      <div class="modal-footer-actions">
        <button class="btn-secondary" onclick="closeExportModal()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="btn-primary" onclick="performExport()">
          <i class="fas fa-download"></i> Generate Export
        </button>
      </div>
    </div>
  </div>

  <div id="equipmentTemplateModal" class="modal" style="display:none">
    <div class="modal-content equipment-template-modal">
      <div class="modal-header" id="templateModalHeader">
        <h2><i class="fas fa-gauge-high" id="templateModalIcon"></i> <span id="templateModalTitle">Select Equipment Template</span></h2>
        <button class="modal-close" onclick="closeEquipmentTemplateModal()">&times;</button>
      </div>
      <p class="modal-subtitle" id="templateModalSubtitle">Choose a specific equipment template to pre-fill your worksheet</p>
      
      <div class="template-selection-content" id="templateSelectionContent">
        <!-- Templates will be dynamically loaded here -->
      </div>

      <div class="modal-footer-actions">
        <button class="btn-secondary" onclick="skipTemplateSelection()">
          <i class="fas fa-forward"></i> Skip & Create Blank Worksheet
        </button>
      </div>
    </div>
  </div>

  <!-- Pressure Template Selection Modal -->
  <div id="pressureTemplateModal" class="modal" style="display:none">
    <div class="modal-content template-modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-gauge-high"></i> Pressure Equipment Templates</h2>
        <button class="modal-close" onclick="closePressureTemplates()">&times;</button>
      </div>
      <p class="modal-subtitle">Select a pre-configured template for your calibration worksheet</p>
      
      <div class="template-categories">
        <!-- Pressure Transmitters -->
        <div class="template-category">
          <h3><i class="fas fa-broadcast-tower"></i> Pressure Transmitters</h3>
          <div class="template-list">
            <div class="template-item" onclick="selectPressureTemplate('pressure_transmitter_0-100psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge"></i>
              </div>
              <div class="template-item-info">
                <h4>0-100 psi Transmitter</h4>
                <p>Rosemount 3051CD â€¢ 5 test points â€¢ Rising/Falling</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('pressure_transmitter_0-300psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge"></i>
              </div>
              <div class="template-item-info">
                <h4>0-300 psi Transmitter</h4>
                <p>Yokogawa EJA110A â€¢ 6 test points â€¢ Rising/Falling</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('pressure_transmitter_0-1000psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge"></i>
              </div>
              <div class="template-item-info">
                <h4>0-1000 psi Transmitter</h4>
                <p>Rosemount 3051CG â€¢ 5 test points â€¢ High Pressure</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
        </div>

        <!-- Pressure Gauges -->
        <div class="template-category">
          <h3><i class="fas fa-gauge-simple"></i> Pressure Gauges</h3>
          <div class="template-list">
            <div class="template-item" onclick="selectPressureTemplate('pressure_gauge_0-100psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge-simple"></i>
              </div>
              <div class="template-item-info">
                <h4>0-100 psi Analog Gauge</h4>
                <p>Ashcroft 1005D â€¢ Mechanical â€¢ 5 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('pressure_gauge_0-300psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge-simple"></i>
              </div>
              <div class="template-item-info">
                <h4>0-300 psi Analog Gauge</h4>
                <p>Wika 232.50 â€¢ Medium Range â€¢ 6 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('digital_pressure_gauge_0-500psi')">
              <div class="template-item-icon">
                <i class="fas fa-display"></i>
              </div>
              <div class="template-item-info">
                <h4>0-500 psi Digital Gauge</h4>
                <p>Fluke 700G27 â€¢ High Accuracy â€¢ 6 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
        </div>

        <!-- Differential Pressure -->
        <div class="template-category">
          <h3><i class="fas fa-arrows-left-right"></i> Differential Pressure</h3>
          <div class="template-list">
            <div class="template-item" onclick="selectPressureTemplate('dp_transmitter_0-100inH2O')">
              <div class="template-item-icon">
                <i class="fas fa-compress-arrows-alt"></i>
              </div>
              <div class="template-item-info">
                <h4>0-100 inH2O DP Transmitter</h4>
                <p>Rosemount 3051CD â€¢ 5 test points â€¢ Current Output</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('dp_gauge_0-50inH2O')">
              <div class="template-item-icon">
                <i class="fas fa-gauge-simple"></i>
              </div>
              <div class="template-item-info">
                <h4>0-50 inH2O DP Gauge</h4>
                <p>Dwyer Magnehelic 2000 â€¢ 6 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
        </div>

        <!-- Vacuum & Others -->
        <div class="template-category">
          <h3><i class="fas fa-wind"></i> Vacuum & Specialty</h3>
          <div class="template-list">
            <div class="template-item" onclick="selectPressureTemplate('vacuum_gauge_0-30inHg')">
              <div class="template-item-icon">
                <i class="fas fa-wind"></i>
              </div>
              <div class="template-item-info">
                <h4>0-30 inHg Vacuum Gauge</h4>
                <p>Ashcroft 1005D â€¢ 5 test points â€¢ Vacuum Range</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('compound_gauge_30inHg-30psi')">
              <div class="template-item-icon">
                <i class="fas fa-gauge-high"></i>
              </div>
              <div class="template-item-info">
                <h4>Compound Gauge (-30 inHg to +30 psi)</h4>
                <p>Ashcroft 1490 â€¢ Vacuum & Pressure â€¢ 5 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('pressure_switch_adjustable')">
              <div class="template-item-icon">
                <i class="fas fa-power-off"></i>
              </div>
              <div class="template-item-info">
                <h4>Adjustable Pressure Switch</h4>
                <p>United Electric H117 â€¢ Setpoint Calibration</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('hp_gauge_0-5000psi')">
              <div class="template-item-icon">
                <i class="fas fa-arrow-up"></i>
              </div>
              <div class="template-item-info">
                <h4>0-5000 psi High Pressure Gauge</h4>
                <p>Ashcroft 2074 â€¢ High Range â€¢ 6 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('pressure_calibrator_portable')">
              <div class="template-item-icon">
                <i class="fas fa-toolbox"></i>
              </div>
              <div class="template-item-info">
                <h4>Portable Pressure Calibrator</h4>
                <p>Fluke 718 300G â€¢ Calibrator Verification â€¢ 5 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
            <div class="template-item" onclick="selectPressureTemplate('barometer_digital')">
              <div class="template-item-icon">
                <i class="fas fa-cloud"></i>
              </div>
              <div class="template-item-info">
                <h4>Digital Barometer</h4>
                <p>Vaisala PTB220 â€¢ Atmospheric Pressure â€¢ 5 test points</p>
              </div>
              <i class="fas fa-chevron-right"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit User Modal -->
  <div id="userModal" class="modal" style="display:none">
    <div class="modal-content" style="max-width: 600px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h3 id="userModalTitle"><i class="fas fa-user-plus"></i> Add User</h3>
        <button class="btn-icon" onclick="closeUserModal()" style="font-size: 24px; color: #999; background: none; border: none; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="userForm" onsubmit="submitUserForm(event)">
        <input type="hidden" id="userId" name="userId">
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Full Name <span style="color: red;">*</span>
          </label>
          <input type="text" id="userFullName" name="full_name" required
                 style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Email <span style="color: red;">*</span>
          </label>
          <input type="email" id="userEmail" name="email" required
                 style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
        </div>

        <div style="margin-bottom: 20px;" id="passwordFieldContainer">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Password <span style="color: red;">*</span>
          </label>
          <input type="password" id="userPassword" name="password"
                 style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
                 placeholder="Min 8 chars, uppercase, lowercase, number, special char">
          <small style="color: #666; display: block; margin-top: 5px;">
            Leave blank to keep existing password (when editing)
          </small>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Role <span style="color: red;">*</span>
          </label>
          <select id="userRole" name="role" required class="form-control"
                  style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
            <option value="">Select Role</option>
            <option value="admin">Admin - Full system access</option>
            <option value="lead_calibrator">Lead Calibrator - View and manage all calibrations</option>
            <option value="calibrator">Calibrator - Create and edit own calibrations</option>
            <option value="viewer">Viewer - Read-only access</option>
          </select>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Job Title
          </label>
          <input type="text" id="userJobTitle" name="job_title"
                 style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
                 placeholder="e.g., Senior Calibration Technician">
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="userIsActive" name="is_active" checked
                   style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
            <span style="font-weight: 500; color: #333;">Active User</span>
          </label>
          <small style="color: #666; display: block; margin-top: 5px; margin-left: 28px;">
            Inactive users cannot log in
          </small>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="userEmailVerified" name="email_verified"
                   style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
            <span style="font-weight: 500; color: #333;">Email Verified</span>
          </label>
          <small style="color: #666; display: block; margin-top: 5px; margin-left: 28px;">
            Allow user to log in without email verification
          </small>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn-secondary" onclick="closeUserModal()">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="submit" class="btn-primary" id="userSubmitBtn">
            <i class="fas fa-save"></i> Save User
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- User Activity Modal -->
  <div id="userActivityModal" class="modal" style="display:none">
    <div class="modal-content" style="max-width: 800px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h3><i class="fas fa-history"></i> User Activity Log</h3>
        <button class="btn-icon" onclick="closeUserActivityModal()" style="font-size: 24px; color: #999; background: none; border: none; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div id="activityLogContent">
        <div style="text-align: center; padding: 40px;">
          <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #FFB800;"></i>
          <p style="margin-top: 10px; color: #999;">Loading activity...</p>
        </div>
      </div>
    </div>
  </div>

  <div id="loadingModal" class="modal" style="display:none">
    <div class="modal-content">
      <h3>Processing...</h3>
      <div class="progress-bar">
        <div id="progressBar" class="progress-fill"></div>
      </div>
      <p id="progressText">Please wait...</p>
    </div>
  </div>

  <!-- Scripts - Deferred for faster loading -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>
  <!-- Equipment database for field technician autocomplete -->
  <script src="equipment-database.js?v=20251015" defer></script>
  <!-- Autocomplete functionality for worksheet fields -->
  <script src="autocomplete.js?v=20251015" defer></script>
  <!-- Pressure equipment calibration templates -->
  <script src="pressure-templates.js?v=20251015" defer></script>
  <!-- Main application logic - MOBILE OPTIMIZED -->
  <script src="app.js?v=20251017" defer></script>
  
  <!-- MOBILE OPTIMIZED: Minimal Critical Path Script Only -->
  <script>
    // Service Worker Registration - Progressive Web App support
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registered'))
        .catch(err => console.warn('SW registration failed', err));
    }

    // Connection status monitoring
    function updateConnectionStatus() {
      const status = document.getElementById('connectionStatus');
      if (status) {
        if (navigator.onLine) {
          status.textContent = 'Online';
          status.className = 'status-indicator online';
        } else {
          status.textContent = 'Offline';
          status.className = 'status-indicator offline';
        }
      }
    }
    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);
    document.addEventListener('DOMContentLoaded', updateConnectionStatus);

    // Mobile-optimized loading screen dismissal
    const isMobile = window.innerWidth <= 768;
    const loadingDelay = isMobile ? 600 : 1200;
    
    setTimeout(() => {
      const loadingScreen = document.getElementById('appLoadingScreen');
      if (loadingScreen) {
        loadingScreen.classList.add('hidden');
        setTimeout(() => loadingScreen.remove(), 300);
      }
    }, loadingDelay);
  </script>
</body>
</html>
